package device.display;

import java.awt.Color;
import java.awt.Event;
import java.awt.event.KeyEvent;
import java.awt.image.BufferedImage;
import java.util.Random;

import org.lwjgl.BufferUtils;
import org.lwjgl.glfw.GLFW;
import org.lwjgl.opengl.GL;
import org.lwjgl.opengl.GL11;
import org.lwjgl.opengl.GL12;
import org.lwjgl.sdl.SDLEvents;
import org.lwjgl.sdl.SDLError;
import org.lwjgl.sdl.SDLInit;
import org.lwjgl.sdl.SDLKeyboard;
import org.lwjgl.sdl.SDLKeycode;
import org.lwjgl.sdl.SDLScancode;
import org.lwjgl.sdl.SDLHints;
import org.lwjgl.sdl.SDLPixels;
import org.lwjgl.sdl.SDLRender;
import org.lwjgl.sdl.SDLVideo;
import org.lwjgl.sdl.SDL_Event;
import org.lwjgl.sdl.SDL_FRect;
import org.lwjgl.sdl.SDL_Rect;
import org.lwjgl.sdl.SDL_DisplayMode;
import org.lwjgl.system.MemoryUtil;

import core.exception.HardwareException;
import core.memory.memory8.Memory8;
import core.memory.memory8.MemoryBusIIe;
import device.display.display8.ScanlineTracer8;
import device.display.display8.TraceMap8;
import device.keyboard.KeyboardIIe;

public class DisplayIIe extends DisplayWindow implements VideoSignalSource {
	private static volatile boolean keyLoggingEnabled;
	private static volatile String windowBackend = "lwjgl";
	private static volatile boolean startFullscreenOnLaunch;
	private static volatile String sdlTextInputMode = "off";
	private static volatile String sdlFullscreenMode = "exclusive";
	private static volatile boolean sdlImeUiSelfImplemented;
	private static volatile boolean sdlTextAnchorDebug;

	private ScanlineTracer8 tracer;

	private Memory8 memory;
	private MemoryBusIIe memoryBus;

	private int textMod;
	private DisplayType displayType;
	private BufferedImage [] rawDisplay;

	private int bufferPage;
	private int paintPage;
	private boolean showFps;
	private long fpsWindowStartNs;
	private int fpsFrameCount;
	private int xPaint;
	private int yPaint;
	private int colorWord;
	private int colorWordSize;
	private int shiftBit;
	private int offset40 = 0;

	private int flashToggle = 0;
	private int lastSwitchIteration;

	private int [] pal;
	private int palIndex;
	private int hueShift = -32;
	private KeyboardIIe keyboard;
	private long glfwWindow;
	private long sdlWindow;
	private long sdlGlContext;
	private long sdlRenderer;
	private long sdlTexture;
	private java.nio.ByteBuffer sdlTextureBytes;
	private java.nio.IntBuffer sdlTextureInts;
	private int textureId;
	private java.nio.IntBuffer uploadPixels;
	private boolean linearFilteringActive;
	private boolean textureFilteringInitialized;
	private boolean fullscreen;
	private int windowedX;
	private int windowedY;
	private int windowedWidth = WINDOW_WIDTH;
	private int windowedHeight = WINDOW_HEIGHT;
	private long fullscreenTransitionGuardUntilNs;
	private boolean pendingStartFullscreen;
	private boolean pendingSdlTextInputModeApply;
	private boolean pendingSdlInputGrabApply;
	private boolean initializationComplete;

	private static final int PAL_INDEX_COLOR = 0;
	private static final int PAL_INDEX_MONO = 48;
	private static final int PAL_INDEX_MONO_GREEN = 2*48;
	private static final int PAL_BRIGHTNESS = 160;
	private static final int OFFSET40 = 7;

	private static final int XSIZE = 567;
	private static final int YSIZE = 384;
	private static final int SPLIT_DRAW = 320;
	private static final float WINDOW_BORDER_RATIO = 0.07f;
	private static final float CONTENT_FRACTION = 1.0f - (2.0f * WINDOW_BORDER_RATIO);
	private static final int CONTENT_WIDTH = XSIZE + 2;
	private static final int CONTENT_HEIGHT = YSIZE;
	private static final int BORDER_X = Math.round((CONTENT_WIDTH * WINDOW_BORDER_RATIO) / CONTENT_FRACTION);
	private static final int BORDER_Y = Math.round((CONTENT_HEIGHT * WINDOW_BORDER_RATIO) / CONTENT_FRACTION);
	private static final int WINDOW_WIDTH = CONTENT_WIDTH + (BORDER_X * 2);
	private static final int WINDOW_HEIGHT = CONTENT_HEIGHT + (BORDER_Y * 2);
	private static final long FULLSCREEN_TRANSITION_GUARD_NS = 1_500_000_000L;
	private static final int SDL_TEXT_ANCHOR_BELOW_OFFSET = 400;

	public static void setWindowBackend(String backend) {
		if( backend==null ) {
			windowBackend = "lwjgl";
			return;
		}
		String normalized = backend.trim().toLowerCase();
		if( normalized.isEmpty() )
			normalized = "lwjgl";
		if( !"lwjgl".equals(normalized) && !"sdl".equals(normalized) )
			throw new IllegalArgumentException("Unsupported window backend: "+backend+" (expected lwjgl or sdl)");
		windowBackend = normalized;
	}

	public static void setStartFullscreenOnLaunch(boolean enabled) {
		startFullscreenOnLaunch = enabled;
	}

	public static void setSdlTextInputMode(String mode) {
		if( mode==null ) {
			sdlTextInputMode = "off";
			return;
		}
		String normalized = mode.trim().toLowerCase();
		if( normalized.isEmpty() )
			normalized = "off";
		if( !"off".equals(normalized) && !"offscreen".equals(normalized) && !"normal".equals(normalized) && !"center".equals(normalized) )
			throw new IllegalArgumentException("Unsupported text input mode: "+mode+" (expected off, offscreen, normal, or center)");
		sdlTextInputMode = normalized;
	}

	public static void setSdlFullscreenMode(String mode) {
		if( mode==null ) {
			sdlFullscreenMode = "exclusive";
			return;
		}
		String normalized = mode.trim().toLowerCase();
		if( normalized.isEmpty() )
			normalized = "exclusive";
		if( !"exclusive".equals(normalized) && !"desktop".equals(normalized) )
			throw new IllegalArgumentException("Unsupported SDL fullscreen mode: "+mode+" (expected exclusive or desktop)");
		sdlFullscreenMode = normalized;
	}

	public static void setSdlImeUiSelfImplemented(boolean enabled) {
		sdlImeUiSelfImplemented = enabled;
	}

	public static void setSdlTextAnchorDebug(boolean enabled) {
		sdlTextAnchorDebug = enabled;
	}

	public static final TraceMap8 LO40_TRACE;
	public static final TraceMap8 HI40_TRACE;

	static {

		LO40_TRACE = new TraceMap8(7, 262);
		LO40_TRACE.setPageBit(10);
		LO40_TRACE.addScanlineTrace(0, 103, 8);
		LO40_TRACE.addScanlineTrace(1, 103, 8);
		LO40_TRACE.addScanlineTrace(2, 103, 8);
		LO40_TRACE.addScanlineTrace(3, 103, 8);
		LO40_TRACE.addScanlineTrace(4, 103, 8);
		LO40_TRACE.addScanlineTrace(5, 103, 8);
		LO40_TRACE.addScanlineTrace(6, 103, 8);
		LO40_TRACE.addScanlineTrace(7, 103, 14);
		LO40_TRACE.addScanlineTrace(0, 103, 8);
		LO40_TRACE.addScanlineTrace(1, 103, 8);
		LO40_TRACE.addScanlineTrace(2, 103, 8);
		LO40_TRACE.addScanlineTrace(3, 103, 8);
		LO40_TRACE.addScanlineTrace(4, 103, 8);
		LO40_TRACE.addScanlineTrace(5, 103, 8);
		LO40_TRACE.addScanlineTrace(6, 103, 8);
		LO40_TRACE.addScanlineTrace(7, 103, 8);
		LO40_TRACE.addScanlineTrace(0, 15, 8);
		LO40_TRACE.addScanlineTrace(1, 15, 8);
		LO40_TRACE.addScanlineTrace(2, 15, 8);
		LO40_TRACE.addScanlineTrace(3, 15, 8);
		LO40_TRACE.addScanlineTrace(4, 15, 8);
		LO40_TRACE.addScanlineTrace(5, 15, 8);
		LO40_TRACE.addScanlineTrace(6, 15, 8);
		LO40_TRACE.addScanlineTrace(7, 15, 8);
		LO40_TRACE.addScanlineTrace(0, 55, 8);
		LO40_TRACE.addScanlineTrace(1, 55, 8);
		LO40_TRACE.addScanlineTrace(2, 55, 8);
		LO40_TRACE.addScanlineTrace(3, 55, 8);
		LO40_TRACE.addScanlineTrace(4, 55, 8);
		LO40_TRACE.addScanlineTrace(5, 55, 8);
		LO40_TRACE.addScanlineTrace(6, 55, 8);
		LO40_TRACE.addScanlineTrace(7, 55, 8);

		HI40_TRACE = new TraceMap8(7, 262);
		HI40_TRACE.setPageBit(13);
		HI40_TRACE.addScanlineTrace(0, 103);
		HI40_TRACE.addScanlineTrace(8, 103);
		HI40_TRACE.addScanlineTrace(16, 103);
		HI40_TRACE.addScanlineTrace(24, 103);
		HI40_TRACE.addScanlineTrace(32, 103);
		HI40_TRACE.addScanlineTrace(40, 103);
		HI40_TRACE.addScanlineTrace(48, 103);
		HI40_TRACE.addScanlineTrace(56, 103);
		HI40_TRACE.addScanlineTrace(1, 103);
		HI40_TRACE.addScanlineTrace(9, 103);
		HI40_TRACE.addScanlineTrace(17, 103);
		HI40_TRACE.addScanlineTrace(25, 103);
		HI40_TRACE.addScanlineTrace(33, 103);
		HI40_TRACE.addScanlineTrace(41, 103);
		HI40_TRACE.addScanlineTrace(49, 103);
		HI40_TRACE.addScanlineTrace(57, 103);
		HI40_TRACE.addScanlineTrace(2, 103);
		HI40_TRACE.addScanlineTrace(10, 103);
		HI40_TRACE.addScanlineTrace(18, 103);
		HI40_TRACE.addScanlineTrace(26, 103);
		HI40_TRACE.addScanlineTrace(34, 103);
		HI40_TRACE.addScanlineTrace(42, 103);
		HI40_TRACE.addScanlineTrace(50, 103);
		HI40_TRACE.addScanlineTrace(58, 103);
		HI40_TRACE.addScanlineTrace(3, 103);
		HI40_TRACE.addScanlineTrace(11, 103);
		HI40_TRACE.addScanlineTrace(19, 103);
		HI40_TRACE.addScanlineTrace(27, 103);
		HI40_TRACE.addScanlineTrace(35, 103);
		HI40_TRACE.addScanlineTrace(43, 103);
		HI40_TRACE.addScanlineTrace(51, 103);
		HI40_TRACE.addScanlineTrace(59, 103);
		HI40_TRACE.addScanlineTrace(4, 103);
		HI40_TRACE.addScanlineTrace(12, 103);
		HI40_TRACE.addScanlineTrace(20, 103);
		HI40_TRACE.addScanlineTrace(28, 103);
		HI40_TRACE.addScanlineTrace(36, 103);
		HI40_TRACE.addScanlineTrace(44, 103);
		HI40_TRACE.addScanlineTrace(52, 103);
		HI40_TRACE.addScanlineTrace(60, 103);
		HI40_TRACE.addScanlineTrace(5, 103);
		HI40_TRACE.addScanlineTrace(13, 103);
		HI40_TRACE.addScanlineTrace(21, 103);
		HI40_TRACE.addScanlineTrace(29, 103);
		HI40_TRACE.addScanlineTrace(37, 103);
		HI40_TRACE.addScanlineTrace(45, 103);
		HI40_TRACE.addScanlineTrace(53, 103);
		HI40_TRACE.addScanlineTrace(61, 103);
		HI40_TRACE.addScanlineTrace(6, 103);
		HI40_TRACE.addScanlineTrace(14, 103);
		HI40_TRACE.addScanlineTrace(22, 103);
		HI40_TRACE.addScanlineTrace(30, 103);
		HI40_TRACE.addScanlineTrace(38, 103);
		HI40_TRACE.addScanlineTrace(46, 103);
		HI40_TRACE.addScanlineTrace(54, 103);
		HI40_TRACE.addScanlineTrace(62, 103);
		HI40_TRACE.addScanlineTrace(7, 103);
		HI40_TRACE.addScanlineTrace(15, 103);
		HI40_TRACE.addScanlineTrace(23, 103);
		HI40_TRACE.addScanlineTrace(31, 103);
		HI40_TRACE.addScanlineTrace(39, 103);
		HI40_TRACE.addScanlineTrace(47, 103);
		HI40_TRACE.addScanlineTrace(55, 103);
		HI40_TRACE.addScanlineTrace(63, 103);
		HI40_TRACE.addScanlineTrace(23, 103);
		HI40_TRACE.addScanlineTrace(31, 103);
		HI40_TRACE.addScanlineTrace(39, 103);
		HI40_TRACE.addScanlineTrace(47, 103);
		HI40_TRACE.addScanlineTrace(55, 103);
		HI40_TRACE.addScanlineTrace(63, 103);
		HI40_TRACE.addScanlineTrace(0, 103);
		HI40_TRACE.addScanlineTrace(8, 103);
		HI40_TRACE.addScanlineTrace(16, 103);
		HI40_TRACE.addScanlineTrace(24, 103);
		HI40_TRACE.addScanlineTrace(32, 103);
		HI40_TRACE.addScanlineTrace(40, 103);
		HI40_TRACE.addScanlineTrace(48, 103);
		HI40_TRACE.addScanlineTrace(56, 103);
		HI40_TRACE.addScanlineTrace(1, 103);
		HI40_TRACE.addScanlineTrace(9, 103);
		HI40_TRACE.addScanlineTrace(17, 103);
		HI40_TRACE.addScanlineTrace(25, 103);
		HI40_TRACE.addScanlineTrace(33, 103);
		HI40_TRACE.addScanlineTrace(41, 103);
		HI40_TRACE.addScanlineTrace(49, 103);
		HI40_TRACE.addScanlineTrace(57, 103);
		HI40_TRACE.addScanlineTrace(2, 103);
		HI40_TRACE.addScanlineTrace(10, 103);
		HI40_TRACE.addScanlineTrace(18, 103);
		HI40_TRACE.addScanlineTrace(26, 103);
		HI40_TRACE.addScanlineTrace(34, 103);
		HI40_TRACE.addScanlineTrace(42, 103);
		HI40_TRACE.addScanlineTrace(50, 103);
		HI40_TRACE.addScanlineTrace(58, 103);
		HI40_TRACE.addScanlineTrace(3, 103);
		HI40_TRACE.addScanlineTrace(11, 103);
		HI40_TRACE.addScanlineTrace(19, 103);
		HI40_TRACE.addScanlineTrace(27, 103);
		HI40_TRACE.addScanlineTrace(35, 103);
		HI40_TRACE.addScanlineTrace(43, 103);
		HI40_TRACE.addScanlineTrace(51, 103);
		HI40_TRACE.addScanlineTrace(59, 103);
		HI40_TRACE.addScanlineTrace(4, 103);
		HI40_TRACE.addScanlineTrace(12, 103);
		HI40_TRACE.addScanlineTrace(20, 103);
		HI40_TRACE.addScanlineTrace(28, 103);
		HI40_TRACE.addScanlineTrace(36, 103);
		HI40_TRACE.addScanlineTrace(44, 103);
		HI40_TRACE.addScanlineTrace(52, 103);
		HI40_TRACE.addScanlineTrace(60, 103);
		HI40_TRACE.addScanlineTrace(5, 103);
		HI40_TRACE.addScanlineTrace(13, 103);
		HI40_TRACE.addScanlineTrace(21, 103);
		HI40_TRACE.addScanlineTrace(29, 103);
		HI40_TRACE.addScanlineTrace(37, 103);
		HI40_TRACE.addScanlineTrace(45, 103);
		HI40_TRACE.addScanlineTrace(53, 103);
		HI40_TRACE.addScanlineTrace(61, 103);
		HI40_TRACE.addScanlineTrace(6, 103);
		HI40_TRACE.addScanlineTrace(14, 103);
		HI40_TRACE.addScanlineTrace(22, 103);
		HI40_TRACE.addScanlineTrace(30, 103);
		HI40_TRACE.addScanlineTrace(38, 103);
		HI40_TRACE.addScanlineTrace(46, 103);
		HI40_TRACE.addScanlineTrace(54, 103);
		HI40_TRACE.addScanlineTrace(62, 103);
		HI40_TRACE.addScanlineTrace(7, 103);
		HI40_TRACE.addScanlineTrace(15, 103);
		HI40_TRACE.addScanlineTrace(23, 103);
		HI40_TRACE.addScanlineTrace(31, 103);
		HI40_TRACE.addScanlineTrace(39, 103);
		HI40_TRACE.addScanlineTrace(47, 103);
		HI40_TRACE.addScanlineTrace(55, 103);
		HI40_TRACE.addScanlineTrace(63, 103);
		HI40_TRACE.addScanlineTrace(0, 15);
		HI40_TRACE.addScanlineTrace(8, 15);
		HI40_TRACE.addScanlineTrace(16, 15);
		HI40_TRACE.addScanlineTrace(24, 15);
		HI40_TRACE.addScanlineTrace(32, 15);
		HI40_TRACE.addScanlineTrace(40, 15);
		HI40_TRACE.addScanlineTrace(48, 15);
		HI40_TRACE.addScanlineTrace(56, 15);
		HI40_TRACE.addScanlineTrace(1, 15);
		HI40_TRACE.addScanlineTrace(9, 15);
		HI40_TRACE.addScanlineTrace(17, 15);
		HI40_TRACE.addScanlineTrace(25, 15);
		HI40_TRACE.addScanlineTrace(33, 15);
		HI40_TRACE.addScanlineTrace(41, 15);
		HI40_TRACE.addScanlineTrace(49, 15);
		HI40_TRACE.addScanlineTrace(57, 15);
		HI40_TRACE.addScanlineTrace(2, 15);
		HI40_TRACE.addScanlineTrace(10, 15);
		HI40_TRACE.addScanlineTrace(18, 15);
		HI40_TRACE.addScanlineTrace(26, 15);
		HI40_TRACE.addScanlineTrace(34, 15);
		HI40_TRACE.addScanlineTrace(42, 15);
		HI40_TRACE.addScanlineTrace(50, 15);
		HI40_TRACE.addScanlineTrace(58, 15);
		HI40_TRACE.addScanlineTrace(3, 15);
		HI40_TRACE.addScanlineTrace(11, 15);
		HI40_TRACE.addScanlineTrace(19, 15);
		HI40_TRACE.addScanlineTrace(27, 15);
		HI40_TRACE.addScanlineTrace(35, 15);
		HI40_TRACE.addScanlineTrace(43, 15);
		HI40_TRACE.addScanlineTrace(51, 15);
		HI40_TRACE.addScanlineTrace(59, 15);
		HI40_TRACE.addScanlineTrace(4, 15);
		HI40_TRACE.addScanlineTrace(12, 15);
		HI40_TRACE.addScanlineTrace(20, 15);
		HI40_TRACE.addScanlineTrace(28, 15);
		HI40_TRACE.addScanlineTrace(36, 15);
		HI40_TRACE.addScanlineTrace(44, 15);
		HI40_TRACE.addScanlineTrace(52, 15);
		HI40_TRACE.addScanlineTrace(60, 15);
		HI40_TRACE.addScanlineTrace(5, 15);
		HI40_TRACE.addScanlineTrace(13, 15);
		HI40_TRACE.addScanlineTrace(21, 15);
		HI40_TRACE.addScanlineTrace(29, 15);
		HI40_TRACE.addScanlineTrace(37, 15);
		HI40_TRACE.addScanlineTrace(45, 15);
		HI40_TRACE.addScanlineTrace(53, 15);
		HI40_TRACE.addScanlineTrace(61, 15);
		HI40_TRACE.addScanlineTrace(6, 15);
		HI40_TRACE.addScanlineTrace(14, 15);
		HI40_TRACE.addScanlineTrace(22, 15);
		HI40_TRACE.addScanlineTrace(30, 15);
		HI40_TRACE.addScanlineTrace(38, 15);
		HI40_TRACE.addScanlineTrace(46, 15);
		HI40_TRACE.addScanlineTrace(54, 15);
		HI40_TRACE.addScanlineTrace(62, 15);
		HI40_TRACE.addScanlineTrace(7, 15);
		HI40_TRACE.addScanlineTrace(15, 15);
		HI40_TRACE.addScanlineTrace(23, 15);
		HI40_TRACE.addScanlineTrace(31, 15);
		HI40_TRACE.addScanlineTrace(39, 15);
		HI40_TRACE.addScanlineTrace(47, 15);
		HI40_TRACE.addScanlineTrace(55, 15);
		HI40_TRACE.addScanlineTrace(63, 15);
		HI40_TRACE.addScanlineTrace(0, 55);
		HI40_TRACE.addScanlineTrace(8, 55);
		HI40_TRACE.addScanlineTrace(16, 55);
		HI40_TRACE.addScanlineTrace(24, 55);
		HI40_TRACE.addScanlineTrace(32, 55);
		HI40_TRACE.addScanlineTrace(40, 55);
		HI40_TRACE.addScanlineTrace(48, 55);
		HI40_TRACE.addScanlineTrace(56, 55);
		HI40_TRACE.addScanlineTrace(1, 55);
		HI40_TRACE.addScanlineTrace(9, 55);
		HI40_TRACE.addScanlineTrace(17, 55);
		HI40_TRACE.addScanlineTrace(25, 55);
		HI40_TRACE.addScanlineTrace(33, 55);
		HI40_TRACE.addScanlineTrace(41, 55);
		HI40_TRACE.addScanlineTrace(49, 55);
		HI40_TRACE.addScanlineTrace(57, 55);
		HI40_TRACE.addScanlineTrace(2, 55);
		HI40_TRACE.addScanlineTrace(10, 55);
		HI40_TRACE.addScanlineTrace(18, 55);
		HI40_TRACE.addScanlineTrace(26, 55);
		HI40_TRACE.addScanlineTrace(34, 55);
		HI40_TRACE.addScanlineTrace(42, 55);
		HI40_TRACE.addScanlineTrace(50, 55);
		HI40_TRACE.addScanlineTrace(58, 55);
		HI40_TRACE.addScanlineTrace(3, 55);
		HI40_TRACE.addScanlineTrace(11, 55);
		HI40_TRACE.addScanlineTrace(19, 55);
		HI40_TRACE.addScanlineTrace(27, 55);
		HI40_TRACE.addScanlineTrace(35, 55);
		HI40_TRACE.addScanlineTrace(43, 55);
		HI40_TRACE.addScanlineTrace(51, 55);
		HI40_TRACE.addScanlineTrace(59, 55);
		HI40_TRACE.addScanlineTrace(4, 55);
		HI40_TRACE.addScanlineTrace(12, 55);
		HI40_TRACE.addScanlineTrace(20, 55);
		HI40_TRACE.addScanlineTrace(28, 55);
		HI40_TRACE.addScanlineTrace(36, 55);
		HI40_TRACE.addScanlineTrace(44, 55);
		HI40_TRACE.addScanlineTrace(52, 55);
		HI40_TRACE.addScanlineTrace(60, 55);
		HI40_TRACE.addScanlineTrace(5, 55);
		HI40_TRACE.addScanlineTrace(13, 55);
		HI40_TRACE.addScanlineTrace(21, 55);
		HI40_TRACE.addScanlineTrace(29, 55);
		HI40_TRACE.addScanlineTrace(37, 55);
		HI40_TRACE.addScanlineTrace(45, 55);
		HI40_TRACE.addScanlineTrace(53, 55);
		HI40_TRACE.addScanlineTrace(61, 55);
		HI40_TRACE.addScanlineTrace(6, 55);
		HI40_TRACE.addScanlineTrace(14, 55);
		HI40_TRACE.addScanlineTrace(22, 55);
		HI40_TRACE.addScanlineTrace(30, 55);
		HI40_TRACE.addScanlineTrace(38, 55);
		HI40_TRACE.addScanlineTrace(46, 55);
		HI40_TRACE.addScanlineTrace(54, 55);
		HI40_TRACE.addScanlineTrace(62, 55);
		HI40_TRACE.addScanlineTrace(7, 55);
		HI40_TRACE.addScanlineTrace(15, 55);
		HI40_TRACE.addScanlineTrace(23, 55);
		HI40_TRACE.addScanlineTrace(31, 55);
		HI40_TRACE.addScanlineTrace(39, 55);
		HI40_TRACE.addScanlineTrace(47, 55);
		HI40_TRACE.addScanlineTrace(55, 55);
		HI40_TRACE.addScanlineTrace(63, 55);

	}

	private static final byte[] TEXT_DISPLAY = {

		// Normal text

		0x63, 0x5d, 0x55, 0x45, 0x65, 0x7d, 0x43, 0x7f,
		0x77, 0x6b, 0x5d, 0x5d, 0x41, 0x5d, 0x5d, 0x7f,
		0x61, 0x5d, 0x5d, 0x61, 0x5d, 0x5d, 0x61, 0x7f,
		0x63, 0x5d, 0x7d, 0x7d, 0x7d, 0x5d, 0x63, 0x7f,
		0x61, 0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x61, 0x7f,
		0x41, 0x7d, 0x7d, 0x61, 0x7d, 0x7d, 0x41, 0x7f,
		0x41, 0x7d, 0x7d, 0x61, 0x7d, 0x7d, 0x7d, 0x7f,
		0x43, 0x7d, 0x7d, 0x7d, 0x4d, 0x5d, 0x43, 0x7f,
		0x5d, 0x5d, 0x5d, 0x41, 0x5d, 0x5d, 0x5d, 0x7f,
		0x63, 0x77, 0x77, 0x77, 0x77, 0x77, 0x63, 0x7f,
		0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5d, 0x63, 0x7f,
		0x5d, 0x6d, 0x75, 0x79, 0x75, 0x6d, 0x5d, 0x7f,
		0x7d, 0x7d, 0x7d, 0x7d, 0x7d, 0x7d, 0x41, 0x7f,
		0x5d, 0x49, 0x55, 0x55, 0x5d, 0x5d, 0x5d, 0x7f,
		0x5d, 0x5d, 0x59, 0x55, 0x4d, 0x5d, 0x5d, 0x7f,
		0x63, 0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x63, 0x7f,
		0x61, 0x5d, 0x5d, 0x61, 0x7d, 0x7d, 0x7d, 0x7f,
		0x63, 0x5d, 0x5d, 0x5d, 0x55, 0x6d, 0x53, 0x7f,
		0x61, 0x5d, 0x5d, 0x61, 0x75, 0x6d, 0x5d, 0x7f,
		0x63, 0x5d, 0x7d, 0x63, 0x5f, 0x5d, 0x63, 0x7f,
		0x41, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x7f,
		0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x63, 0x7f,
		0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x6b, 0x77, 0x7f,
		0x5d, 0x5d, 0x5d, 0x55, 0x55, 0x49, 0x5d, 0x7f,
		0x5d, 0x5d, 0x6b, 0x77, 0x6b, 0x5d, 0x5d, 0x7f,
		0x5d, 0x5d, 0x6b, 0x77, 0x77, 0x77, 0x77, 0x7f,
		0x41, 0x5f, 0x6f, 0x77, 0x7b, 0x7d, 0x41, 0x7f,
		0x41, 0x79, 0x79, 0x79, 0x79, 0x79, 0x41, 0x7f,
		0x7f, 0x7d, 0x7b, 0x77, 0x6f, 0x5f, 0x7f, 0x7f,
		0x41, 0x4f, 0x4f, 0x4f, 0x4f, 0x4f, 0x41, 0x7f,
		0x7f, 0x7f, 0x77, 0x6b, 0x5d, 0x7f, 0x7f, 0x7f,
		0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x00,
		0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f,
		0x77, 0x77, 0x77, 0x77, 0x77, 0x7f, 0x77, 0x7f,
		0x6b, 0x6b, 0x6b, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f,
		0x6b, 0x6b, 0x41, 0x6b, 0x41, 0x6b, 0x6b, 0x7f,
		0x77, 0x43, 0x75, 0x63, 0x57, 0x61, 0x77, 0x7f,
		0x79, 0x59, 0x6f, 0x77, 0x7b, 0x4d, 0x4f, 0x7f,
		0x7b, 0x75, 0x75, 0x7b, 0x55, 0x6d, 0x53, 0x7f,
		0x77, 0x77, 0x77, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f,
		0x77, 0x7b, 0x7d, 0x7d, 0x7d, 0x7b, 0x77, 0x7f,
		0x77, 0x6f, 0x5f, 0x5f, 0x5f, 0x6f, 0x77, 0x7f,
		0x77, 0x55, 0x63, 0x77, 0x63, 0x55, 0x77, 0x7f,
		0x7f, 0x77, 0x77, 0x41, 0x77, 0x77, 0x7f, 0x7f,
		0x7f, 0x7f, 0x7f, 0x7f, 0x77, 0x77, 0x7b, 0x7f,
		0x7f, 0x7f, 0x7f, 0x41, 0x7f, 0x7f, 0x7f, 0x7f,
		0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x77, 0x7f,
		0x7f, 0x5f, 0x6f, 0x77, 0x7b, 0x7d, 0x7f, 0x7f,
		0x63, 0x5d, 0x4d, 0x55, 0x59, 0x5d, 0x63, 0x7f,
		0x77, 0x73, 0x77, 0x77, 0x77, 0x77, 0x63, 0x7f,
		0x63, 0x5d, 0x5f, 0x67, 0x7b, 0x7d, 0x41, 0x7f,
		0x41, 0x5f, 0x6f, 0x67, 0x5f, 0x5d, 0x63, 0x7f,
		0x6f, 0x67, 0x6b, 0x6d, 0x41, 0x6f, 0x6f, 0x7f,
		0x41, 0x7d, 0x61, 0x5f, 0x5f, 0x5d, 0x63, 0x7f,
		0x47, 0x7b, 0x7d, 0x61, 0x5d, 0x5d, 0x63, 0x7f,
		0x41, 0x5f, 0x6f, 0x77, 0x7b, 0x7b, 0x7b, 0x7f,
		0x63, 0x5d, 0x5d, 0x63, 0x5d, 0x5d, 0x63, 0x7f,
		0x63, 0x5d, 0x5d, 0x43, 0x5f, 0x6f, 0x71, 0x7f,
		0x7f, 0x7f, 0x77, 0x7f, 0x77, 0x7f, 0x7f, 0x7f,
		0x7f, 0x7f, 0x77, 0x7f, 0x77, 0x77, 0x7b, 0x7f,
		0x6f, 0x77, 0x7b, 0x7d, 0x7b, 0x77, 0x6f, 0x7f,
		0x7f, 0x7f, 0x41, 0x7f, 0x41, 0x7f, 0x7f, 0x7f,
		0x7b, 0x77, 0x6f, 0x5f, 0x6f, 0x77, 0x7b, 0x7f,
		0x63, 0x5d, 0x6f, 0x77, 0x77, 0x7f, 0x77, 0x7f,
		0x1c, 0x22, 0x2a, 0x3a, 0x1a, 0x02, 0x3c, 0x00,
		0x08, 0x14, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x22, 0x22, 0x1e, 0x00,
		0x1c, 0x22, 0x02, 0x02, 0x02, 0x22, 0x1c, 0x00,
		0x1e, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1e, 0x00,
		0x3e, 0x02, 0x02, 0x1e, 0x02, 0x02, 0x3e, 0x00,
		0x3e, 0x02, 0x02, 0x1e, 0x02, 0x02, 0x02, 0x00,
		0x3c, 0x02, 0x02, 0x02, 0x32, 0x22, 0x3c, 0x00,
		0x22, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x22, 0x00,
		0x1c, 0x08, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00,
		0x20, 0x20, 0x20, 0x20, 0x20, 0x22, 0x1c, 0x00,
		0x22, 0x12, 0x0a, 0x06, 0x0a, 0x12, 0x22, 0x00,
		0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x3e, 0x00,
		0x22, 0x36, 0x2a, 0x2a, 0x22, 0x22, 0x22, 0x00,
		0x22, 0x22, 0x26, 0x2a, 0x32, 0x22, 0x22, 0x00,
		0x1c, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1c, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x02, 0x02, 0x02, 0x00,
		0x1c, 0x22, 0x22, 0x22, 0x2a, 0x12, 0x2c, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x0a, 0x12, 0x22, 0x00,
		0x1c, 0x22, 0x02, 0x1c, 0x20, 0x22, 0x1c, 0x00,
		0x3e, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00,
		0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1c, 0x00,
		0x22, 0x22, 0x22, 0x22, 0x22, 0x14, 0x08, 0x00,
		0x22, 0x22, 0x22, 0x2a, 0x2a, 0x36, 0x22, 0x00,
		0x22, 0x22, 0x14, 0x08, 0x14, 0x22, 0x22, 0x00,
		0x22, 0x22, 0x14, 0x08, 0x08, 0x08, 0x08, 0x00,
		0x3e, 0x20, 0x10, 0x08, 0x04, 0x02, 0x3e, 0x00,
		0x3e, 0x06, 0x06, 0x06, 0x06, 0x06, 0x3e, 0x00,
		0x00, 0x02, 0x04, 0x08, 0x10, 0x20, 0x00, 0x00,
		0x3e, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3e, 0x00,
		0x00, 0x00, 0x08, 0x14, 0x22, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x08, 0x08, 0x08, 0x08, 0x08, 0x00, 0x08, 0x00,
		0x14, 0x14, 0x14, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x14, 0x14, 0x3e, 0x14, 0x3e, 0x14, 0x14, 0x00,
		0x08, 0x3c, 0x0a, 0x1c, 0x28, 0x1e, 0x08, 0x00,
		0x06, 0x26, 0x10, 0x08, 0x04, 0x32, 0x30, 0x00,
		0x04, 0x0a, 0x0a, 0x04, 0x2a, 0x12, 0x2c, 0x00,
		0x08, 0x08, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x08, 0x04, 0x02, 0x02, 0x02, 0x04, 0x08, 0x00,
		0x08, 0x10, 0x20, 0x20, 0x20, 0x10, 0x08, 0x00,
		0x08, 0x2a, 0x1c, 0x08, 0x1c, 0x2a, 0x08, 0x00,
		0x00, 0x08, 0x08, 0x3e, 0x08, 0x08, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0x04, 0x00,
		0x00, 0x00, 0x00, 0x3e, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00,
		0x00, 0x20, 0x10, 0x08, 0x04, 0x02, 0x00, 0x00,
		0x1c, 0x22, 0x32, 0x2a, 0x26, 0x22, 0x1c, 0x00,
		0x08, 0x0c, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00,
		0x1c, 0x22, 0x20, 0x18, 0x04, 0x02, 0x3e, 0x00,
		0x3e, 0x20, 0x10, 0x18, 0x20, 0x22, 0x1c, 0x00,
		0x10, 0x18, 0x14, 0x12, 0x3e, 0x10, 0x10, 0x00,
		0x3e, 0x02, 0x1e, 0x20, 0x20, 0x22, 0x1c, 0x00,
		0x38, 0x04, 0x02, 0x1e, 0x22, 0x22, 0x1c, 0x00,
		0x3e, 0x20, 0x10, 0x08, 0x04, 0x04, 0x04, 0x00,
		0x1c, 0x22, 0x22, 0x1c, 0x22, 0x22, 0x1c, 0x00,
		0x1c, 0x22, 0x22, 0x3c, 0x20, 0x10, 0x0e, 0x00,
		0x00, 0x00, 0x08, 0x00, 0x08, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x08, 0x00, 0x08, 0x08, 0x04, 0x00,
		0x10, 0x08, 0x04, 0x02, 0x04, 0x08, 0x10, 0x00,
		0x00, 0x00, 0x3e, 0x00, 0x3e, 0x00, 0x00, 0x00,
		0x04, 0x08, 0x10, 0x20, 0x10, 0x08, 0x04, 0x00,
		0x1c, 0x22, 0x10, 0x08, 0x08, 0x00, 0x08, 0x00,
		0x1c, 0x22, 0x2a, 0x3a, 0x1a, 0x02, 0x3c, 0x00,
		0x08, 0x14, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x22, 0x22, 0x1e, 0x00,
		0x1c, 0x22, 0x02, 0x02, 0x02, 0x22, 0x1c, 0x00,
		0x1e, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1e, 0x00,
		0x3e, 0x02, 0x02, 0x1e, 0x02, 0x02, 0x3e, 0x00,
		0x3e, 0x02, 0x02, 0x1e, 0x02, 0x02, 0x02, 0x00,
		0x3c, 0x02, 0x02, 0x02, 0x32, 0x22, 0x3c, 0x00,
		0x22, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x22, 0x00,
		0x1c, 0x08, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00,
		0x20, 0x20, 0x20, 0x20, 0x20, 0x22, 0x1c, 0x00,
		0x22, 0x12, 0x0a, 0x06, 0x0a, 0x12, 0x22, 0x00,
		0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x3e, 0x00,
		0x22, 0x36, 0x2a, 0x2a, 0x22, 0x22, 0x22, 0x00,
		0x22, 0x22, 0x26, 0x2a, 0x32, 0x22, 0x22, 0x00,
		0x1c, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1c, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x02, 0x02, 0x02, 0x00,
		0x1c, 0x22, 0x22, 0x22, 0x2a, 0x12, 0x2c, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x0a, 0x12, 0x22, 0x00,
		0x1c, 0x22, 0x02, 0x1c, 0x20, 0x22, 0x1c, 0x00,
		0x3e, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00,
		0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1c, 0x00,
		0x22, 0x22, 0x22, 0x22, 0x22, 0x14, 0x08, 0x00,
		0x22, 0x22, 0x22, 0x2a, 0x2a, 0x36, 0x22, 0x00,
		0x22, 0x22, 0x14, 0x08, 0x14, 0x22, 0x22, 0x00,
		0x22, 0x22, 0x14, 0x08, 0x08, 0x08, 0x08, 0x00,
		0x3e, 0x20, 0x10, 0x08, 0x04, 0x02, 0x3e, 0x00,
		0x3e, 0x06, 0x06, 0x06, 0x06, 0x06, 0x3e, 0x00,
		0x00, 0x02, 0x04, 0x08, 0x10, 0x20, 0x00, 0x00,
		0x3e, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3e, 0x00,
		0x00, 0x00, 0x08, 0x14, 0x22, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x08, 0x08, 0x08, 0x08, 0x08, 0x00, 0x08, 0x00,
		0x14, 0x14, 0x14, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x14, 0x14, 0x3e, 0x14, 0x3e, 0x14, 0x14, 0x00,
		0x08, 0x3c, 0x0a, 0x1c, 0x28, 0x1e, 0x08, 0x00,
		0x06, 0x26, 0x10, 0x08, 0x04, 0x32, 0x30, 0x00,
		0x04, 0x0a, 0x0a, 0x04, 0x2a, 0x12, 0x2c, 0x00,
		0x08, 0x08, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x08, 0x04, 0x02, 0x02, 0x02, 0x04, 0x08, 0x00,
		0x08, 0x10, 0x20, 0x20, 0x20, 0x10, 0x08, 0x00,
		0x08, 0x2a, 0x1c, 0x08, 0x1c, 0x2a, 0x08, 0x00,
		0x00, 0x08, 0x08, 0x3e, 0x08, 0x08, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0x04, 0x00,
		0x00, 0x00, 0x00, 0x3e, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00,
		0x00, 0x20, 0x10, 0x08, 0x04, 0x02, 0x00, 0x00,
		0x1c, 0x22, 0x32, 0x2a, 0x26, 0x22, 0x1c, 0x00,
		0x08, 0x0c, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00,
		0x1c, 0x22, 0x20, 0x18, 0x04, 0x02, 0x3e, 0x00,
		0x3e, 0x20, 0x10, 0x18, 0x20, 0x22, 0x1c, 0x00,
		0x10, 0x18, 0x14, 0x12, 0x3e, 0x10, 0x10, 0x00,
		0x3e, 0x02, 0x1e, 0x20, 0x20, 0x22, 0x1c, 0x00,
		0x38, 0x04, 0x02, 0x1e, 0x22, 0x22, 0x1c, 0x00,
		0x3e, 0x20, 0x10, 0x08, 0x04, 0x04, 0x04, 0x00,
		0x1c, 0x22, 0x22, 0x1c, 0x22, 0x22, 0x1c, 0x00,
		0x1c, 0x22, 0x22, 0x3c, 0x20, 0x10, 0x0e, 0x00,
		0x00, 0x00, 0x08, 0x00, 0x08, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x08, 0x00, 0x08, 0x08, 0x04, 0x00,
		0x10, 0x08, 0x04, 0x02, 0x04, 0x08, 0x10, 0x00,
		0x00, 0x00, 0x3e, 0x00, 0x3e, 0x00, 0x00, 0x00,
		0x04, 0x08, 0x10, 0x20, 0x10, 0x08, 0x04, 0x00,
		0x1c, 0x22, 0x10, 0x08, 0x08, 0x00, 0x08, 0x00,
		0x1c, 0x22, 0x2a, 0x3a, 0x1a, 0x02, 0x3c, 0x00,
		0x08, 0x14, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x22, 0x22, 0x1e, 0x00,
		0x1c, 0x22, 0x02, 0x02, 0x02, 0x22, 0x1c, 0x00,
		0x1e, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1e, 0x00,
		0x3e, 0x02, 0x02, 0x1e, 0x02, 0x02, 0x3e, 0x00,
		0x3e, 0x02, 0x02, 0x1e, 0x02, 0x02, 0x02, 0x00,
		0x3c, 0x02, 0x02, 0x02, 0x32, 0x22, 0x3c, 0x00,
		0x22, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x22, 0x00,
		0x1c, 0x08, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00,
		0x20, 0x20, 0x20, 0x20, 0x20, 0x22, 0x1c, 0x00,
		0x22, 0x12, 0x0a, 0x06, 0x0a, 0x12, 0x22, 0x00,
		0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x3e, 0x00,
		0x22, 0x36, 0x2a, 0x2a, 0x22, 0x22, 0x22, 0x00,
		0x22, 0x22, 0x26, 0x2a, 0x32, 0x22, 0x22, 0x00,
		0x1c, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1c, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x02, 0x02, 0x02, 0x00,
		0x1c, 0x22, 0x22, 0x22, 0x2a, 0x12, 0x2c, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x0a, 0x12, 0x22, 0x00,
		0x1c, 0x22, 0x02, 0x1c, 0x20, 0x22, 0x1c, 0x00,
		0x3e, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00,
		0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1c, 0x00,
		0x22, 0x22, 0x22, 0x22, 0x22, 0x14, 0x08, 0x00,
		0x22, 0x22, 0x22, 0x2a, 0x2a, 0x36, 0x22, 0x00,
		0x22, 0x22, 0x14, 0x08, 0x14, 0x22, 0x22, 0x00,
		0x22, 0x22, 0x14, 0x08, 0x08, 0x08, 0x08, 0x00,
		0x3e, 0x20, 0x10, 0x08, 0x04, 0x02, 0x3e, 0x00,
		0x3e, 0x06, 0x06, 0x06, 0x06, 0x06, 0x3e, 0x00,
		0x00, 0x02, 0x04, 0x08, 0x10, 0x20, 0x00, 0x00,
		0x3e, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3e, 0x00,
		0x00, 0x00, 0x08, 0x14, 0x22, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f,
		0x04, 0x08, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x1c, 0x20, 0x3c, 0x22, 0x3c, 0x00,
		0x02, 0x02, 0x1e, 0x22, 0x22, 0x22, 0x1e, 0x00,
		0x00, 0x00, 0x3c, 0x02, 0x02, 0x02, 0x3c, 0x00,
		0x20, 0x20, 0x3c, 0x22, 0x22, 0x22, 0x3c, 0x00,
		0x00, 0x00, 0x1c, 0x22, 0x3e, 0x02, 0x3c, 0x00,
		0x18, 0x24, 0x04, 0x1e, 0x04, 0x04, 0x04, 0x00,
		0x00, 0x00, 0x1c, 0x22, 0x22, 0x3c, 0x20, 0x1c,
		0x02, 0x02, 0x1e, 0x22, 0x22, 0x22, 0x22, 0x00,
		0x08, 0x00, 0x0c, 0x08, 0x08, 0x08, 0x1c, 0x00,
		0x10, 0x00, 0x18, 0x10, 0x10, 0x10, 0x12, 0x0c,
		0x02, 0x02, 0x22, 0x12, 0x0e, 0x12, 0x22, 0x00,
		0x0c, 0x08, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00,
		0x00, 0x00, 0x36, 0x2a, 0x2a, 0x2a, 0x22, 0x00,
		0x00, 0x00, 0x1e, 0x22, 0x22, 0x22, 0x22, 0x00,
		0x00, 0x00, 0x1c, 0x22, 0x22, 0x22, 0x1c, 0x00,
		0x00, 0x00, 0x1e, 0x22, 0x22, 0x1e, 0x02, 0x02,
		0x00, 0x00, 0x3c, 0x22, 0x22, 0x3c, 0x20, 0x20,
		0x00, 0x00, 0x3a, 0x06, 0x02, 0x02, 0x02, 0x00,
		0x00, 0x00, 0x3c, 0x02, 0x1c, 0x20, 0x1e, 0x00,
		0x00, 0x04, 0x1e, 0x04, 0x04, 0x24, 0x18, 0x00,
		0x00, 0x00, 0x22, 0x22, 0x22, 0x32, 0x2c, 0x00,
		0x00, 0x00, 0x22, 0x22, 0x22, 0x14, 0x08, 0x00,
		0x00, 0x00, 0x22, 0x22, 0x2a, 0x2a, 0x36, 0x00,
		0x00, 0x00, 0x22, 0x14, 0x08, 0x14, 0x22, 0x00,
		0x00, 0x00, 0x22, 0x22, 0x22, 0x3c, 0x20, 0x1c,
		0x00, 0x00, 0x3e, 0x10, 0x08, 0x04, 0x3e, 0x00,
		0x38, 0x0c, 0x0c, 0x06, 0x0c, 0x0c, 0x38, 0x00,
		0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08,
		0x0e, 0x18, 0x18, 0x30, 0x18, 0x18, 0x0e, 0x00,
		0x2c, 0x1a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x2a, 0x14, 0x2a, 0x14, 0x2a, 0x00, 0x00,

		// Flash text

		0x63, 0x5d, 0x55, 0x45, 0x65, 0x7d, 0x43, 0x7f,
		0x77, 0x6b, 0x5d, 0x5d, 0x41, 0x5d, 0x5d, 0x7f,
		0x61, 0x5d, 0x5d, 0x61, 0x5d, 0x5d, 0x61, 0x7f,
		0x63, 0x5d, 0x7d, 0x7d, 0x7d, 0x5d, 0x63, 0x7f,
		0x61, 0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x61, 0x7f,
		0x41, 0x7d, 0x7d, 0x61, 0x7d, 0x7d, 0x41, 0x7f,
		0x41, 0x7d, 0x7d, 0x61, 0x7d, 0x7d, 0x7d, 0x7f,
		0x43, 0x7d, 0x7d, 0x7d, 0x4d, 0x5d, 0x43, 0x7f,
		0x5d, 0x5d, 0x5d, 0x41, 0x5d, 0x5d, 0x5d, 0x7f,
		0x63, 0x77, 0x77, 0x77, 0x77, 0x77, 0x63, 0x7f,
		0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5d, 0x63, 0x7f,
		0x5d, 0x6d, 0x75, 0x79, 0x75, 0x6d, 0x5d, 0x7f,
		0x7d, 0x7d, 0x7d, 0x7d, 0x7d, 0x7d, 0x41, 0x7f,
		0x5d, 0x49, 0x55, 0x55, 0x5d, 0x5d, 0x5d, 0x7f,
		0x5d, 0x5d, 0x59, 0x55, 0x4d, 0x5d, 0x5d, 0x7f,
		0x63, 0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x63, 0x7f,
		0x61, 0x5d, 0x5d, 0x61, 0x7d, 0x7d, 0x7d, 0x7f,
		0x63, 0x5d, 0x5d, 0x5d, 0x55, 0x6d, 0x53, 0x7f,
		0x61, 0x5d, 0x5d, 0x61, 0x75, 0x6d, 0x5d, 0x7f,
		0x63, 0x5d, 0x7d, 0x63, 0x5f, 0x5d, 0x63, 0x7f,
		0x41, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x7f,
		0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x63, 0x7f,
		0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x6b, 0x77, 0x7f,
		0x5d, 0x5d, 0x5d, 0x55, 0x55, 0x49, 0x5d, 0x7f,
		0x5d, 0x5d, 0x6b, 0x77, 0x6b, 0x5d, 0x5d, 0x7f,
		0x5d, 0x5d, 0x6b, 0x77, 0x77, 0x77, 0x77, 0x7f,
		0x41, 0x5f, 0x6f, 0x77, 0x7b, 0x7d, 0x41, 0x7f,
		0x41, 0x79, 0x79, 0x79, 0x79, 0x79, 0x41, 0x7f,
		0x7f, 0x7d, 0x7b, 0x77, 0x6f, 0x5f, 0x7f, 0x7f,
		0x41, 0x4f, 0x4f, 0x4f, 0x4f, 0x4f, 0x41, 0x7f,
		0x7f, 0x7f, 0x77, 0x6b, 0x5d, 0x7f, 0x7f, 0x7f,
		0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x00,
		0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f,
		0x77, 0x77, 0x77, 0x77, 0x77, 0x7f, 0x77, 0x7f,
		0x6b, 0x6b, 0x6b, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f,
		0x6b, 0x6b, 0x41, 0x6b, 0x41, 0x6b, 0x6b, 0x7f,
		0x77, 0x43, 0x75, 0x63, 0x57, 0x61, 0x77, 0x7f,
		0x79, 0x59, 0x6f, 0x77, 0x7b, 0x4d, 0x4f, 0x7f,
		0x7b, 0x75, 0x75, 0x7b, 0x55, 0x6d, 0x53, 0x7f,
		0x77, 0x77, 0x77, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f,
		0x77, 0x7b, 0x7d, 0x7d, 0x7d, 0x7b, 0x77, 0x7f,
		0x77, 0x6f, 0x5f, 0x5f, 0x5f, 0x6f, 0x77, 0x7f,
		0x77, 0x55, 0x63, 0x77, 0x63, 0x55, 0x77, 0x7f,
		0x7f, 0x77, 0x77, 0x41, 0x77, 0x77, 0x7f, 0x7f,
		0x7f, 0x7f, 0x7f, 0x7f, 0x77, 0x77, 0x7b, 0x7f,
		0x7f, 0x7f, 0x7f, 0x41, 0x7f, 0x7f, 0x7f, 0x7f,
		0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x77, 0x7f,
		0x7f, 0x5f, 0x6f, 0x77, 0x7b, 0x7d, 0x7f, 0x7f,
		0x63, 0x5d, 0x4d, 0x55, 0x59, 0x5d, 0x63, 0x7f,
		0x77, 0x73, 0x77, 0x77, 0x77, 0x77, 0x63, 0x7f,
		0x63, 0x5d, 0x5f, 0x67, 0x7b, 0x7d, 0x41, 0x7f,
		0x41, 0x5f, 0x6f, 0x67, 0x5f, 0x5d, 0x63, 0x7f,
		0x6f, 0x67, 0x6b, 0x6d, 0x41, 0x6f, 0x6f, 0x7f,
		0x41, 0x7d, 0x61, 0x5f, 0x5f, 0x5d, 0x63, 0x7f,
		0x47, 0x7b, 0x7d, 0x61, 0x5d, 0x5d, 0x63, 0x7f,
		0x41, 0x5f, 0x6f, 0x77, 0x7b, 0x7b, 0x7b, 0x7f,
		0x63, 0x5d, 0x5d, 0x63, 0x5d, 0x5d, 0x63, 0x7f,
		0x63, 0x5d, 0x5d, 0x43, 0x5f, 0x6f, 0x71, 0x7f,
		0x7f, 0x7f, 0x77, 0x7f, 0x77, 0x7f, 0x7f, 0x7f,
		0x7f, 0x7f, 0x77, 0x7f, 0x77, 0x77, 0x7b, 0x7f,
		0x6f, 0x77, 0x7b, 0x7d, 0x7b, 0x77, 0x6f, 0x7f,
		0x7f, 0x7f, 0x41, 0x7f, 0x41, 0x7f, 0x7f, 0x7f,
		0x7b, 0x77, 0x6f, 0x5f, 0x6f, 0x77, 0x7b, 0x7f,
		0x63, 0x5d, 0x6f, 0x77, 0x77, 0x7f, 0x77, 0x7f,
		0x63, 0x5d, 0x55, 0x45, 0x65, 0x7d, 0x43, 0x7f,
		0x77, 0x6b, 0x5d, 0x5d, 0x41, 0x5d, 0x5d, 0x7f,
		0x61, 0x5d, 0x5d, 0x61, 0x5d, 0x5d, 0x61, 0x7f,
		0x63, 0x5d, 0x7d, 0x7d, 0x7d, 0x5d, 0x63, 0x7f,
		0x61, 0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x61, 0x7f,
		0x41, 0x7d, 0x7d, 0x61, 0x7d, 0x7d, 0x41, 0x7f,
		0x41, 0x7d, 0x7d, 0x61, 0x7d, 0x7d, 0x7d, 0x7f,
		0x43, 0x7d, 0x7d, 0x7d, 0x4d, 0x5d, 0x43, 0x7f,
		0x5d, 0x5d, 0x5d, 0x41, 0x5d, 0x5d, 0x5d, 0x7f,
		0x63, 0x77, 0x77, 0x77, 0x77, 0x77, 0x63, 0x7f,
		0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5d, 0x63, 0x7f,
		0x5d, 0x6d, 0x75, 0x79, 0x75, 0x6d, 0x5d, 0x7f,
		0x7d, 0x7d, 0x7d, 0x7d, 0x7d, 0x7d, 0x41, 0x7f,
		0x5d, 0x49, 0x55, 0x55, 0x5d, 0x5d, 0x5d, 0x7f,
		0x5d, 0x5d, 0x59, 0x55, 0x4d, 0x5d, 0x5d, 0x7f,
		0x63, 0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x63, 0x7f,
		0x61, 0x5d, 0x5d, 0x61, 0x7d, 0x7d, 0x7d, 0x7f,
		0x63, 0x5d, 0x5d, 0x5d, 0x55, 0x6d, 0x53, 0x7f,
		0x61, 0x5d, 0x5d, 0x61, 0x75, 0x6d, 0x5d, 0x7f,
		0x63, 0x5d, 0x7d, 0x63, 0x5f, 0x5d, 0x63, 0x7f,
		0x41, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x7f,
		0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x63, 0x7f,
		0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x6b, 0x77, 0x7f,
		0x5d, 0x5d, 0x5d, 0x55, 0x55, 0x49, 0x5d, 0x7f,
		0x5d, 0x5d, 0x6b, 0x77, 0x6b, 0x5d, 0x5d, 0x7f,
		0x5d, 0x5d, 0x6b, 0x77, 0x77, 0x77, 0x77, 0x7f,
		0x41, 0x5f, 0x6f, 0x77, 0x7b, 0x7d, 0x41, 0x7f,
		0x41, 0x79, 0x79, 0x79, 0x79, 0x79, 0x41, 0x7f,
		0x7f, 0x7d, 0x7b, 0x77, 0x6f, 0x5f, 0x7f, 0x7f,
		0x41, 0x4f, 0x4f, 0x4f, 0x4f, 0x4f, 0x41, 0x7f,
		0x7f, 0x7f, 0x77, 0x6b, 0x5d, 0x7f, 0x7f, 0x7f,
		0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x00,
		0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f,
		0x77, 0x77, 0x77, 0x77, 0x77, 0x7f, 0x77, 0x7f,
		0x6b, 0x6b, 0x6b, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f,
		0x6b, 0x6b, 0x41, 0x6b, 0x41, 0x6b, 0x6b, 0x7f,
		0x77, 0x43, 0x75, 0x63, 0x57, 0x61, 0x77, 0x7f,
		0x79, 0x59, 0x6f, 0x77, 0x7b, 0x4d, 0x4f, 0x7f,
		0x7b, 0x75, 0x75, 0x7b, 0x55, 0x6d, 0x53, 0x7f,
		0x77, 0x77, 0x77, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f,
		0x77, 0x7b, 0x7d, 0x7d, 0x7d, 0x7b, 0x77, 0x7f,
		0x77, 0x6f, 0x5f, 0x5f, 0x5f, 0x6f, 0x77, 0x7f,
		0x77, 0x55, 0x63, 0x77, 0x63, 0x55, 0x77, 0x7f,
		0x7f, 0x77, 0x77, 0x41, 0x77, 0x77, 0x7f, 0x7f,
		0x7f, 0x7f, 0x7f, 0x7f, 0x77, 0x77, 0x7b, 0x7f,
		0x7f, 0x7f, 0x7f, 0x41, 0x7f, 0x7f, 0x7f, 0x7f,
		0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x77, 0x7f,
		0x7f, 0x5f, 0x6f, 0x77, 0x7b, 0x7d, 0x7f, 0x7f,
		0x63, 0x5d, 0x4d, 0x55, 0x59, 0x5d, 0x63, 0x7f,
		0x77, 0x73, 0x77, 0x77, 0x77, 0x77, 0x63, 0x7f,
		0x63, 0x5d, 0x5f, 0x67, 0x7b, 0x7d, 0x41, 0x7f,
		0x41, 0x5f, 0x6f, 0x67, 0x5f, 0x5d, 0x63, 0x7f,
		0x6f, 0x67, 0x6b, 0x6d, 0x41, 0x6f, 0x6f, 0x7f,
		0x41, 0x7d, 0x61, 0x5f, 0x5f, 0x5d, 0x63, 0x7f,
		0x47, 0x7b, 0x7d, 0x61, 0x5d, 0x5d, 0x63, 0x7f,
		0x41, 0x5f, 0x6f, 0x77, 0x7b, 0x7b, 0x7b, 0x7f,
		0x63, 0x5d, 0x5d, 0x63, 0x5d, 0x5d, 0x63, 0x7f,
		0x63, 0x5d, 0x5d, 0x43, 0x5f, 0x6f, 0x71, 0x7f,
		0x7f, 0x7f, 0x77, 0x7f, 0x77, 0x7f, 0x7f, 0x7f,
		0x7f, 0x7f, 0x77, 0x7f, 0x77, 0x77, 0x7b, 0x7f,
		0x6f, 0x77, 0x7b, 0x7d, 0x7b, 0x77, 0x6f, 0x7f,
		0x7f, 0x7f, 0x41, 0x7f, 0x41, 0x7f, 0x7f, 0x7f,
		0x7b, 0x77, 0x6f, 0x5f, 0x6f, 0x77, 0x7b, 0x7f,
		0x63, 0x5d, 0x6f, 0x77, 0x77, 0x7f, 0x77, 0x7f,
		0x1c, 0x22, 0x2a, 0x3a, 0x1a, 0x02, 0x3c, 0x00,
		0x08, 0x14, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x22, 0x22, 0x1e, 0x00,
		0x1c, 0x22, 0x02, 0x02, 0x02, 0x22, 0x1c, 0x00,
		0x1e, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1e, 0x00,
		0x3e, 0x02, 0x02, 0x1e, 0x02, 0x02, 0x3e, 0x00,
		0x3e, 0x02, 0x02, 0x1e, 0x02, 0x02, 0x02, 0x00,
		0x3c, 0x02, 0x02, 0x02, 0x32, 0x22, 0x3c, 0x00,
		0x22, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x22, 0x00,
		0x1c, 0x08, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00,
		0x20, 0x20, 0x20, 0x20, 0x20, 0x22, 0x1c, 0x00,
		0x22, 0x12, 0x0a, 0x06, 0x0a, 0x12, 0x22, 0x00,
		0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x3e, 0x00,
		0x22, 0x36, 0x2a, 0x2a, 0x22, 0x22, 0x22, 0x00,
		0x22, 0x22, 0x26, 0x2a, 0x32, 0x22, 0x22, 0x00,
		0x1c, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1c, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x02, 0x02, 0x02, 0x00,
		0x1c, 0x22, 0x22, 0x22, 0x2a, 0x12, 0x2c, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x0a, 0x12, 0x22, 0x00,
		0x1c, 0x22, 0x02, 0x1c, 0x20, 0x22, 0x1c, 0x00,
		0x3e, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00,
		0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1c, 0x00,
		0x22, 0x22, 0x22, 0x22, 0x22, 0x14, 0x08, 0x00,
		0x22, 0x22, 0x22, 0x2a, 0x2a, 0x36, 0x22, 0x00,
		0x22, 0x22, 0x14, 0x08, 0x14, 0x22, 0x22, 0x00,
		0x22, 0x22, 0x14, 0x08, 0x08, 0x08, 0x08, 0x00,
		0x3e, 0x20, 0x10, 0x08, 0x04, 0x02, 0x3e, 0x00,
		0x3e, 0x06, 0x06, 0x06, 0x06, 0x06, 0x3e, 0x00,
		0x00, 0x02, 0x04, 0x08, 0x10, 0x20, 0x00, 0x00,
		0x3e, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3e, 0x00,
		0x00, 0x00, 0x08, 0x14, 0x22, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x08, 0x08, 0x08, 0x08, 0x08, 0x00, 0x08, 0x00,
		0x14, 0x14, 0x14, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x14, 0x14, 0x3e, 0x14, 0x3e, 0x14, 0x14, 0x00,
		0x08, 0x3c, 0x0a, 0x1c, 0x28, 0x1e, 0x08, 0x00,
		0x06, 0x26, 0x10, 0x08, 0x04, 0x32, 0x30, 0x00,
		0x04, 0x0a, 0x0a, 0x04, 0x2a, 0x12, 0x2c, 0x00,
		0x08, 0x08, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x08, 0x04, 0x02, 0x02, 0x02, 0x04, 0x08, 0x00,
		0x08, 0x10, 0x20, 0x20, 0x20, 0x10, 0x08, 0x00,
		0x08, 0x2a, 0x1c, 0x08, 0x1c, 0x2a, 0x08, 0x00,
		0x00, 0x08, 0x08, 0x3e, 0x08, 0x08, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0x04, 0x00,
		0x00, 0x00, 0x00, 0x3e, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00,
		0x00, 0x20, 0x10, 0x08, 0x04, 0x02, 0x00, 0x00,
		0x1c, 0x22, 0x32, 0x2a, 0x26, 0x22, 0x1c, 0x00,
		0x08, 0x0c, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00,
		0x1c, 0x22, 0x20, 0x18, 0x04, 0x02, 0x3e, 0x00,
		0x3e, 0x20, 0x10, 0x18, 0x20, 0x22, 0x1c, 0x00,
		0x10, 0x18, 0x14, 0x12, 0x3e, 0x10, 0x10, 0x00,
		0x3e, 0x02, 0x1e, 0x20, 0x20, 0x22, 0x1c, 0x00,
		0x38, 0x04, 0x02, 0x1e, 0x22, 0x22, 0x1c, 0x00,
		0x3e, 0x20, 0x10, 0x08, 0x04, 0x04, 0x04, 0x00,
		0x1c, 0x22, 0x22, 0x1c, 0x22, 0x22, 0x1c, 0x00,
		0x1c, 0x22, 0x22, 0x3c, 0x20, 0x10, 0x0e, 0x00,
		0x00, 0x00, 0x08, 0x00, 0x08, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x08, 0x00, 0x08, 0x08, 0x04, 0x00,
		0x10, 0x08, 0x04, 0x02, 0x04, 0x08, 0x10, 0x00,
		0x00, 0x00, 0x3e, 0x00, 0x3e, 0x00, 0x00, 0x00,
		0x04, 0x08, 0x10, 0x20, 0x10, 0x08, 0x04, 0x00,
		0x1c, 0x22, 0x10, 0x08, 0x08, 0x00, 0x08, 0x00,
		0x1c, 0x22, 0x2a, 0x3a, 0x1a, 0x02, 0x3c, 0x00,
		0x08, 0x14, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x22, 0x22, 0x1e, 0x00,
		0x1c, 0x22, 0x02, 0x02, 0x02, 0x22, 0x1c, 0x00,
		0x1e, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1e, 0x00,
		0x3e, 0x02, 0x02, 0x1e, 0x02, 0x02, 0x3e, 0x00,
		0x3e, 0x02, 0x02, 0x1e, 0x02, 0x02, 0x02, 0x00,
		0x3c, 0x02, 0x02, 0x02, 0x32, 0x22, 0x3c, 0x00,
		0x22, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x22, 0x00,
		0x1c, 0x08, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00,
		0x20, 0x20, 0x20, 0x20, 0x20, 0x22, 0x1c, 0x00,
		0x22, 0x12, 0x0a, 0x06, 0x0a, 0x12, 0x22, 0x00,
		0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x3e, 0x00,
		0x22, 0x36, 0x2a, 0x2a, 0x22, 0x22, 0x22, 0x00,
		0x22, 0x22, 0x26, 0x2a, 0x32, 0x22, 0x22, 0x00,
		0x1c, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1c, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x02, 0x02, 0x02, 0x00,
		0x1c, 0x22, 0x22, 0x22, 0x2a, 0x12, 0x2c, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x0a, 0x12, 0x22, 0x00,
		0x1c, 0x22, 0x02, 0x1c, 0x20, 0x22, 0x1c, 0x00,
		0x3e, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00,
		0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1c, 0x00,
		0x22, 0x22, 0x22, 0x22, 0x22, 0x14, 0x08, 0x00,
		0x22, 0x22, 0x22, 0x2a, 0x2a, 0x36, 0x22, 0x00,
		0x22, 0x22, 0x14, 0x08, 0x14, 0x22, 0x22, 0x00,
		0x22, 0x22, 0x14, 0x08, 0x08, 0x08, 0x08, 0x00,
		0x3e, 0x20, 0x10, 0x08, 0x04, 0x02, 0x3e, 0x00,
		0x3e, 0x06, 0x06, 0x06, 0x06, 0x06, 0x3e, 0x00,
		0x00, 0x02, 0x04, 0x08, 0x10, 0x20, 0x00, 0x00,
		0x3e, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3e, 0x00,
		0x00, 0x00, 0x08, 0x14, 0x22, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f,
		0x04, 0x08, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x1c, 0x20, 0x3c, 0x22, 0x3c, 0x00,
		0x02, 0x02, 0x1e, 0x22, 0x22, 0x22, 0x1e, 0x00,
		0x00, 0x00, 0x3c, 0x02, 0x02, 0x02, 0x3c, 0x00,
		0x20, 0x20, 0x3c, 0x22, 0x22, 0x22, 0x3c, 0x00,
		0x00, 0x00, 0x1c, 0x22, 0x3e, 0x02, 0x3c, 0x00,
		0x18, 0x24, 0x04, 0x1e, 0x04, 0x04, 0x04, 0x00,
		0x00, 0x00, 0x1c, 0x22, 0x22, 0x3c, 0x20, 0x1c,
		0x02, 0x02, 0x1e, 0x22, 0x22, 0x22, 0x22, 0x00,
		0x08, 0x00, 0x0c, 0x08, 0x08, 0x08, 0x1c, 0x00,
		0x10, 0x00, 0x18, 0x10, 0x10, 0x10, 0x12, 0x0c,
		0x02, 0x02, 0x22, 0x12, 0x0e, 0x12, 0x22, 0x00,
		0x0c, 0x08, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00,
		0x00, 0x00, 0x36, 0x2a, 0x2a, 0x2a, 0x22, 0x00,
		0x00, 0x00, 0x1e, 0x22, 0x22, 0x22, 0x22, 0x00,
		0x00, 0x00, 0x1c, 0x22, 0x22, 0x22, 0x1c, 0x00,
		0x00, 0x00, 0x1e, 0x22, 0x22, 0x1e, 0x02, 0x02,
		0x00, 0x00, 0x3c, 0x22, 0x22, 0x3c, 0x20, 0x20,
		0x00, 0x00, 0x3a, 0x06, 0x02, 0x02, 0x02, 0x00,
		0x00, 0x00, 0x3c, 0x02, 0x1c, 0x20, 0x1e, 0x00,
		0x00, 0x04, 0x1e, 0x04, 0x04, 0x24, 0x18, 0x00,
		0x00, 0x00, 0x22, 0x22, 0x22, 0x32, 0x2c, 0x00,
		0x00, 0x00, 0x22, 0x22, 0x22, 0x14, 0x08, 0x00,
		0x00, 0x00, 0x22, 0x22, 0x2a, 0x2a, 0x36, 0x00,
		0x00, 0x00, 0x22, 0x14, 0x08, 0x14, 0x22, 0x00,
		0x00, 0x00, 0x22, 0x22, 0x22, 0x3c, 0x20, 0x1c,
		0x00, 0x00, 0x3e, 0x10, 0x08, 0x04, 0x3e, 0x00,
		0x38, 0x0c, 0x0c, 0x06, 0x0c, 0x0c, 0x38, 0x00,
		0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08,
		0x0e, 0x18, 0x18, 0x30, 0x18, 0x18, 0x0e, 0x00,
		0x2c, 0x1a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x2a, 0x14, 0x2a, 0x14, 0x2a, 0x00, 0x00,

		// Mouse text

		0x63, 0x5d, 0x55, 0x45, 0x65, 0x7d, 0x43, 0x7f,
		0x77, 0x6b, 0x5d, 0x5d, 0x41, 0x5d, 0x5d, 0x7f,
		0x61, 0x5d, 0x5d, 0x61, 0x5d, 0x5d, 0x61, 0x7f,
		0x63, 0x5d, 0x7d, 0x7d, 0x7d, 0x5d, 0x63, 0x7f,
		0x61, 0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x61, 0x7f,
		0x41, 0x7d, 0x7d, 0x61, 0x7d, 0x7d, 0x41, 0x7f,
		0x41, 0x7d, 0x7d, 0x61, 0x7d, 0x7d, 0x7d, 0x7f,
		0x43, 0x7d, 0x7d, 0x7d, 0x4d, 0x5d, 0x43, 0x7f,
		0x5d, 0x5d, 0x5d, 0x41, 0x5d, 0x5d, 0x5d, 0x7f,
		0x63, 0x77, 0x77, 0x77, 0x77, 0x77, 0x63, 0x7f,
		0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5d, 0x63, 0x7f,
		0x5d, 0x6d, 0x75, 0x79, 0x75, 0x6d, 0x5d, 0x7f,
		0x7d, 0x7d, 0x7d, 0x7d, 0x7d, 0x7d, 0x41, 0x7f,
		0x5d, 0x49, 0x55, 0x55, 0x5d, 0x5d, 0x5d, 0x7f,
		0x5d, 0x5d, 0x59, 0x55, 0x4d, 0x5d, 0x5d, 0x7f,
		0x63, 0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x63, 0x7f,
		0x61, 0x5d, 0x5d, 0x61, 0x7d, 0x7d, 0x7d, 0x7f,
		0x63, 0x5d, 0x5d, 0x5d, 0x55, 0x6d, 0x53, 0x7f,
		0x61, 0x5d, 0x5d, 0x61, 0x75, 0x6d, 0x5d, 0x7f,
		0x63, 0x5d, 0x7d, 0x63, 0x5f, 0x5d, 0x63, 0x7f,
		0x41, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x7f,
		0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x63, 0x7f,
		0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x6b, 0x77, 0x7f,
		0x5d, 0x5d, 0x5d, 0x55, 0x55, 0x49, 0x5d, 0x7f,
		0x5d, 0x5d, 0x6b, 0x77, 0x6b, 0x5d, 0x5d, 0x7f,
		0x5d, 0x5d, 0x6b, 0x77, 0x77, 0x77, 0x77, 0x7f,
		0x41, 0x5f, 0x6f, 0x77, 0x7b, 0x7d, 0x41, 0x7f,
		0x41, 0x79, 0x79, 0x79, 0x79, 0x79, 0x41, 0x7f,
		0x7f, 0x7d, 0x7b, 0x77, 0x6f, 0x5f, 0x7f, 0x7f,
		0x41, 0x4f, 0x4f, 0x4f, 0x4f, 0x4f, 0x41, 0x7f,
		0x7f, 0x7f, 0x77, 0x6b, 0x5d, 0x7f, 0x7f, 0x7f,
		0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x00,
		0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f,
		0x77, 0x77, 0x77, 0x77, 0x77, 0x7f, 0x77, 0x7f,
		0x6b, 0x6b, 0x6b, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f,
		0x6b, 0x6b, 0x41, 0x6b, 0x41, 0x6b, 0x6b, 0x7f,
		0x77, 0x43, 0x75, 0x63, 0x57, 0x61, 0x77, 0x7f,
		0x79, 0x59, 0x6f, 0x77, 0x7b, 0x4d, 0x4f, 0x7f,
		0x7b, 0x75, 0x75, 0x7b, 0x55, 0x6d, 0x53, 0x7f,
		0x77, 0x77, 0x77, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f,
		0x77, 0x7b, 0x7d, 0x7d, 0x7d, 0x7b, 0x77, 0x7f,
		0x77, 0x6f, 0x5f, 0x5f, 0x5f, 0x6f, 0x77, 0x7f,
		0x77, 0x55, 0x63, 0x77, 0x63, 0x55, 0x77, 0x7f,
		0x7f, 0x77, 0x77, 0x41, 0x77, 0x77, 0x7f, 0x7f,
		0x7f, 0x7f, 0x7f, 0x7f, 0x77, 0x77, 0x7b, 0x7f,
		0x7f, 0x7f, 0x7f, 0x41, 0x7f, 0x7f, 0x7f, 0x7f,
		0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x77, 0x7f,
		0x7f, 0x5f, 0x6f, 0x77, 0x7b, 0x7d, 0x7f, 0x7f,
		0x63, 0x5d, 0x4d, 0x55, 0x59, 0x5d, 0x63, 0x7f,
		0x77, 0x73, 0x77, 0x77, 0x77, 0x77, 0x63, 0x7f,
		0x63, 0x5d, 0x5f, 0x67, 0x7b, 0x7d, 0x41, 0x7f,
		0x41, 0x5f, 0x6f, 0x67, 0x5f, 0x5d, 0x63, 0x7f,
		0x6f, 0x67, 0x6b, 0x6d, 0x41, 0x6f, 0x6f, 0x7f,
		0x41, 0x7d, 0x61, 0x5f, 0x5f, 0x5d, 0x63, 0x7f,
		0x47, 0x7b, 0x7d, 0x61, 0x5d, 0x5d, 0x63, 0x7f,
		0x41, 0x5f, 0x6f, 0x77, 0x7b, 0x7b, 0x7b, 0x7f,
		0x63, 0x5d, 0x5d, 0x63, 0x5d, 0x5d, 0x63, 0x7f,
		0x63, 0x5d, 0x5d, 0x43, 0x5f, 0x6f, 0x71, 0x7f,
		0x7f, 0x7f, 0x77, 0x7f, 0x77, 0x7f, 0x7f, 0x7f,
		0x7f, 0x7f, 0x77, 0x7f, 0x77, 0x77, 0x7b, 0x7f,
		0x6f, 0x77, 0x7b, 0x7d, 0x7b, 0x77, 0x6f, 0x7f,
		0x7f, 0x7f, 0x41, 0x7f, 0x41, 0x7f, 0x7f, 0x7f,
		0x7b, 0x77, 0x6f, 0x5f, 0x6f, 0x77, 0x7b, 0x7f,
		0x63, 0x5d, 0x6f, 0x77, 0x77, 0x7f, 0x77, 0x7f,
		0x10, 0x08, 0x36, 0x7f, 0x3f, 0x3f, 0x7e, 0x36,
		0x10, 0x08, 0x36, 0x41, 0x21, 0x21, 0x4a, 0x36,
		0x00, 0x00, 0x02, 0x06, 0x0e, 0x1e, 0x36, 0x42,
		0x7f, 0x22, 0x14, 0x08, 0x08, 0x14, 0x2a, 0x7f,
		0x00, 0x40, 0x20, 0x11, 0x0a, 0x04, 0x04, 0x00,
		0x7f, 0x3f, 0x5f, 0x6c, 0x75, 0x7b, 0x7b, 0x7f,
		0x70, 0x60, 0x7e, 0x31, 0x79, 0x30, 0x3f, 0x02,
		0x00, 0x18, 0x07, 0x00, 0x07, 0x0c, 0x08, 0x70,
		0x08, 0x04, 0x02, 0x7f, 0x02, 0x04, 0x08, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2a,
		0x08, 0x08, 0x08, 0x08, 0x49, 0x2a, 0x1c, 0x08,
		0x08, 0x1c, 0x2a, 0x49, 0x08, 0x08, 0x08, 0x08,
		0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x40, 0x40, 0x40, 0x44, 0x46, 0x7f, 0x06, 0x04,
		0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f,
		0x13, 0x18, 0x1c, 0x7e, 0x1c, 0x18, 0x10, 0x6f,
		0x64, 0x0c, 0x1c, 0x3f, 0x1c, 0x0c, 0x04, 0x7b,
		0x40, 0x48, 0x08, 0x7f, 0x3e, 0x1c, 0x48, 0x40,
		0x40, 0x48, 0x1c, 0x3e, 0x7f, 0x08, 0x48, 0x40,
		0x00, 0x00, 0x00, 0x7f, 0x00, 0x00, 0x00, 0x00,
		0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x7f,
		0x08, 0x10, 0x20, 0x7f, 0x20, 0x10, 0x08, 0x00,
		0x2a, 0x55, 0x2a, 0x55, 0x2a, 0x55, 0x2a, 0x55,
		0x55, 0x2a, 0x55, 0x2a, 0x55, 0x2a, 0x55, 0x2a,
		0x00, 0x3e, 0x41, 0x01, 0x01, 0x01, 0x7f, 0x00,
		0x00, 0x00, 0x3f, 0x40, 0x40, 0x40, 0x7f, 0x00,
		0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40,
		0x08, 0x1c, 0x3e, 0x7f, 0x3e, 0x1c, 0x08, 0x00,
		0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f,
		0x14, 0x14, 0x77, 0x00, 0x77, 0x14, 0x14, 0x00,
		0x7f, 0x40, 0x40, 0x4c, 0x4c, 0x40, 0x40, 0x7f,
		0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
		0x7b, 0x77, 0x6f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f,
		0x7f, 0x7f, 0x63, 0x5f, 0x43, 0x5d, 0x43, 0x7f,
		0x7d, 0x7d, 0x61, 0x5d, 0x5d, 0x5d, 0x61, 0x7f,
		0x7f, 0x7f, 0x43, 0x7d, 0x7d, 0x7d, 0x43, 0x7f,
		0x5f, 0x5f, 0x43, 0x5d, 0x5d, 0x5d, 0x43, 0x7f,
		0x7f, 0x7f, 0x63, 0x5d, 0x41, 0x7d, 0x43, 0x7f,
		0x67, 0x5b, 0x7b, 0x61, 0x7b, 0x7b, 0x7b, 0x7f,
		0x7f, 0x7f, 0x63, 0x5d, 0x5d, 0x43, 0x5f, 0x63,
		0x7d, 0x7d, 0x61, 0x5d, 0x5d, 0x5d, 0x5d, 0x7f,
		0x77, 0x7f, 0x73, 0x77, 0x77, 0x77, 0x63, 0x7f,
		0x6f, 0x7f, 0x67, 0x6f, 0x6f, 0x6f, 0x6d, 0x73,
		0x7d, 0x7d, 0x5d, 0x6d, 0x71, 0x6d, 0x5d, 0x7f,
		0x73, 0x77, 0x77, 0x77, 0x77, 0x77, 0x63, 0x7f,
		0x7f, 0x7f, 0x49, 0x55, 0x55, 0x55, 0x5d, 0x7f,
		0x7f, 0x7f, 0x61, 0x5d, 0x5d, 0x5d, 0x5d, 0x7f,
		0x7f, 0x7f, 0x63, 0x5d, 0x5d, 0x5d, 0x63, 0x7f,
		0x7f, 0x7f, 0x61, 0x5d, 0x5d, 0x61, 0x7d, 0x7d,
		0x7f, 0x7f, 0x43, 0x5d, 0x5d, 0x43, 0x5f, 0x5f,
		0x7f, 0x7f, 0x45, 0x79, 0x7d, 0x7d, 0x7d, 0x7f,
		0x7f, 0x7f, 0x43, 0x7d, 0x63, 0x5f, 0x61, 0x7f,
		0x7f, 0x7b, 0x61, 0x7b, 0x7b, 0x5b, 0x67, 0x7f,
		0x7f, 0x7f, 0x5d, 0x5d, 0x5d, 0x4d, 0x53, 0x7f,
		0x7f, 0x7f, 0x5d, 0x5d, 0x5d, 0x6b, 0x77, 0x7f,
		0x7f, 0x7f, 0x5d, 0x5d, 0x55, 0x55, 0x49, 0x7f,
		0x7f, 0x7f, 0x5d, 0x6b, 0x77, 0x6b, 0x5d, 0x7f,
		0x7f, 0x7f, 0x5d, 0x5d, 0x5d, 0x43, 0x5f, 0x63,
		0x7f, 0x7f, 0x41, 0x6f, 0x77, 0x7b, 0x41, 0x7f,
		0x47, 0x73, 0x73, 0x79, 0x73, 0x73, 0x47, 0x7f,
		0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
		0x71, 0x67, 0x67, 0x4f, 0x67, 0x67, 0x71, 0x7f,
		0x53, 0x65, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f,
		0x7f, 0x55, 0x6b, 0x55, 0x6b, 0x55, 0x7f, 0x7f,
		0x1c, 0x22, 0x2a, 0x3a, 0x1a, 0x02, 0x3c, 0x00,
		0x08, 0x14, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x22, 0x22, 0x1e, 0x00,
		0x1c, 0x22, 0x02, 0x02, 0x02, 0x22, 0x1c, 0x00,
		0x1e, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1e, 0x00,
		0x3e, 0x02, 0x02, 0x1e, 0x02, 0x02, 0x3e, 0x00,
		0x3e, 0x02, 0x02, 0x1e, 0x02, 0x02, 0x02, 0x00,
		0x3c, 0x02, 0x02, 0x02, 0x32, 0x22, 0x3c, 0x00,
		0x22, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x22, 0x00,
		0x1c, 0x08, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00,
		0x20, 0x20, 0x20, 0x20, 0x20, 0x22, 0x1c, 0x00,
		0x22, 0x12, 0x0a, 0x06, 0x0a, 0x12, 0x22, 0x00,
		0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x3e, 0x00,
		0x22, 0x36, 0x2a, 0x2a, 0x22, 0x22, 0x22, 0x00,
		0x22, 0x22, 0x26, 0x2a, 0x32, 0x22, 0x22, 0x00,
		0x1c, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1c, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x02, 0x02, 0x02, 0x00,
		0x1c, 0x22, 0x22, 0x22, 0x2a, 0x12, 0x2c, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x0a, 0x12, 0x22, 0x00,
		0x1c, 0x22, 0x02, 0x1c, 0x20, 0x22, 0x1c, 0x00,
		0x3e, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00,
		0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1c, 0x00,
		0x22, 0x22, 0x22, 0x22, 0x22, 0x14, 0x08, 0x00,
		0x22, 0x22, 0x22, 0x2a, 0x2a, 0x36, 0x22, 0x00,
		0x22, 0x22, 0x14, 0x08, 0x14, 0x22, 0x22, 0x00,
		0x22, 0x22, 0x14, 0x08, 0x08, 0x08, 0x08, 0x00,
		0x3e, 0x20, 0x10, 0x08, 0x04, 0x02, 0x3e, 0x00,
		0x3e, 0x06, 0x06, 0x06, 0x06, 0x06, 0x3e, 0x00,
		0x00, 0x02, 0x04, 0x08, 0x10, 0x20, 0x00, 0x00,
		0x3e, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3e, 0x00,
		0x00, 0x00, 0x08, 0x14, 0x22, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x08, 0x08, 0x08, 0x08, 0x08, 0x00, 0x08, 0x00,
		0x14, 0x14, 0x14, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x14, 0x14, 0x3e, 0x14, 0x3e, 0x14, 0x14, 0x00,
		0x08, 0x3c, 0x0a, 0x1c, 0x28, 0x1e, 0x08, 0x00,
		0x06, 0x26, 0x10, 0x08, 0x04, 0x32, 0x30, 0x00,
		0x04, 0x0a, 0x0a, 0x04, 0x2a, 0x12, 0x2c, 0x00,
		0x08, 0x08, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x08, 0x04, 0x02, 0x02, 0x02, 0x04, 0x08, 0x00,
		0x08, 0x10, 0x20, 0x20, 0x20, 0x10, 0x08, 0x00,
		0x08, 0x2a, 0x1c, 0x08, 0x1c, 0x2a, 0x08, 0x00,
		0x00, 0x08, 0x08, 0x3e, 0x08, 0x08, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0x04, 0x00,
		0x00, 0x00, 0x00, 0x3e, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00,
		0x00, 0x20, 0x10, 0x08, 0x04, 0x02, 0x00, 0x00,
		0x1c, 0x22, 0x32, 0x2a, 0x26, 0x22, 0x1c, 0x00,
		0x08, 0x0c, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00,
		0x1c, 0x22, 0x20, 0x18, 0x04, 0x02, 0x3e, 0x00,
		0x3e, 0x20, 0x10, 0x18, 0x20, 0x22, 0x1c, 0x00,
		0x10, 0x18, 0x14, 0x12, 0x3e, 0x10, 0x10, 0x00,
		0x3e, 0x02, 0x1e, 0x20, 0x20, 0x22, 0x1c, 0x00,
		0x38, 0x04, 0x02, 0x1e, 0x22, 0x22, 0x1c, 0x00,
		0x3e, 0x20, 0x10, 0x08, 0x04, 0x04, 0x04, 0x00,
		0x1c, 0x22, 0x22, 0x1c, 0x22, 0x22, 0x1c, 0x00,
		0x1c, 0x22, 0x22, 0x3c, 0x20, 0x10, 0x0e, 0x00,
		0x00, 0x00, 0x08, 0x00, 0x08, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x08, 0x00, 0x08, 0x08, 0x04, 0x00,
		0x10, 0x08, 0x04, 0x02, 0x04, 0x08, 0x10, 0x00,
		0x00, 0x00, 0x3e, 0x00, 0x3e, 0x00, 0x00, 0x00,
		0x04, 0x08, 0x10, 0x20, 0x10, 0x08, 0x04, 0x00,
		0x1c, 0x22, 0x10, 0x08, 0x08, 0x00, 0x08, 0x00,
		0x1c, 0x22, 0x2a, 0x3a, 0x1a, 0x02, 0x3c, 0x00,
		0x08, 0x14, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x22, 0x22, 0x1e, 0x00,
		0x1c, 0x22, 0x02, 0x02, 0x02, 0x22, 0x1c, 0x00,
		0x1e, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1e, 0x00,
		0x3e, 0x02, 0x02, 0x1e, 0x02, 0x02, 0x3e, 0x00,
		0x3e, 0x02, 0x02, 0x1e, 0x02, 0x02, 0x02, 0x00,
		0x3c, 0x02, 0x02, 0x02, 0x32, 0x22, 0x3c, 0x00,
		0x22, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x22, 0x00,
		0x1c, 0x08, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00,
		0x20, 0x20, 0x20, 0x20, 0x20, 0x22, 0x1c, 0x00,
		0x22, 0x12, 0x0a, 0x06, 0x0a, 0x12, 0x22, 0x00,
		0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x3e, 0x00,
		0x22, 0x36, 0x2a, 0x2a, 0x22, 0x22, 0x22, 0x00,
		0x22, 0x22, 0x26, 0x2a, 0x32, 0x22, 0x22, 0x00,
		0x1c, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1c, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x02, 0x02, 0x02, 0x00,
		0x1c, 0x22, 0x22, 0x22, 0x2a, 0x12, 0x2c, 0x00,
		0x1e, 0x22, 0x22, 0x1e, 0x0a, 0x12, 0x22, 0x00,
		0x1c, 0x22, 0x02, 0x1c, 0x20, 0x22, 0x1c, 0x00,
		0x3e, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00,
		0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1c, 0x00,
		0x22, 0x22, 0x22, 0x22, 0x22, 0x14, 0x08, 0x00,
		0x22, 0x22, 0x22, 0x2a, 0x2a, 0x36, 0x22, 0x00,
		0x22, 0x22, 0x14, 0x08, 0x14, 0x22, 0x22, 0x00,
		0x22, 0x22, 0x14, 0x08, 0x08, 0x08, 0x08, 0x00,
		0x3e, 0x20, 0x10, 0x08, 0x04, 0x02, 0x3e, 0x00,
		0x3e, 0x06, 0x06, 0x06, 0x06, 0x06, 0x3e, 0x00,
		0x00, 0x02, 0x04, 0x08, 0x10, 0x20, 0x00, 0x00,
		0x3e, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3e, 0x00,
		0x00, 0x00, 0x08, 0x14, 0x22, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f,
		0x04, 0x08, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x1c, 0x20, 0x3c, 0x22, 0x3c, 0x00,
		0x02, 0x02, 0x1e, 0x22, 0x22, 0x22, 0x1e, 0x00,
		0x00, 0x00, 0x3c, 0x02, 0x02, 0x02, 0x3c, 0x00,
		0x20, 0x20, 0x3c, 0x22, 0x22, 0x22, 0x3c, 0x00,
		0x00, 0x00, 0x1c, 0x22, 0x3e, 0x02, 0x3c, 0x00,
		0x18, 0x24, 0x04, 0x1e, 0x04, 0x04, 0x04, 0x00,
		0x00, 0x00, 0x1c, 0x22, 0x22, 0x3c, 0x20, 0x1c,
		0x02, 0x02, 0x1e, 0x22, 0x22, 0x22, 0x22, 0x00,
		0x08, 0x00, 0x0c, 0x08, 0x08, 0x08, 0x1c, 0x00,
		0x10, 0x00, 0x18, 0x10, 0x10, 0x10, 0x12, 0x0c,
		0x02, 0x02, 0x22, 0x12, 0x0e, 0x12, 0x22, 0x00,
		0x0c, 0x08, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00,
		0x00, 0x00, 0x36, 0x2a, 0x2a, 0x2a, 0x22, 0x00,
		0x00, 0x00, 0x1e, 0x22, 0x22, 0x22, 0x22, 0x00,
		0x00, 0x00, 0x1c, 0x22, 0x22, 0x22, 0x1c, 0x00,
		0x00, 0x00, 0x1e, 0x22, 0x22, 0x1e, 0x02, 0x02,
		0x00, 0x00, 0x3c, 0x22, 0x22, 0x3c, 0x20, 0x20,
		0x00, 0x00, 0x3a, 0x06, 0x02, 0x02, 0x02, 0x00,
		0x00, 0x00, 0x3c, 0x02, 0x1c, 0x20, 0x1e, 0x00,
		0x00, 0x04, 0x1e, 0x04, 0x04, 0x24, 0x18, 0x00,
		0x00, 0x00, 0x22, 0x22, 0x22, 0x32, 0x2c, 0x00,
		0x00, 0x00, 0x22, 0x22, 0x22, 0x14, 0x08, 0x00,
		0x00, 0x00, 0x22, 0x22, 0x2a, 0x2a, 0x36, 0x00,
		0x00, 0x00, 0x22, 0x14, 0x08, 0x14, 0x22, 0x00,
		0x00, 0x00, 0x22, 0x22, 0x22, 0x3c, 0x20, 0x1c,
		0x00, 0x00, 0x3e, 0x10, 0x08, 0x04, 0x3e, 0x00,
		0x38, 0x0c, 0x0c, 0x06, 0x0c, 0x0c, 0x38, 0x00,
		0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08,
		0x0e, 0x18, 0x18, 0x30, 0x18, 0x18, 0x0e, 0x00,
		0x2c, 0x1a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x2a, 0x14, 0x2a, 0x14, 0x2a, 0x00, 0x00

	};

	private static final int HGR_TO_DHGR[] = new int[] {
		0x0000,	0x0003,	0x000c,	0x000f,	0x0030,	0x0033,	0x003c,	0x003f,
		0x00c0,	0x00c3,	0x00cc,	0x00cf,	0x00f0,	0x00f3,	0x00fc,	0x00ff,
		0x0300,	0x0303,	0x030c,	0x030f,	0x0330,	0x0333,	0x033c,	0x033f,
		0x03c0,	0x03c3,	0x03cc,	0x03cf,	0x03f0,	0x03f3,	0x03fc,	0x03ff,
		0x0c00,	0x0c03,	0x0c0c,	0x0c0f,	0x0c30,	0x0c33,	0x0c3c,	0x0c3f,
		0x0cc0,	0x0cc3,	0x0ccc,	0x0ccf,	0x0cf0,	0x0cf3,	0x0cfc,	0x0cff,
		0x0f00,	0x0f03,	0x0f0c,	0x0f0f,	0x0f30,	0x0f33,	0x0f3c,	0x0f3f,
		0x0fc0,	0x0fc3,	0x0fcc,	0x0fcf,	0x0ff0,	0x0ff3,	0x0ffc,	0x0fff,
		0x3000,	0x3003,	0x300c,	0x300f,	0x3030,	0x3033,	0x303c,	0x303f,
		0x30c0,	0x30c3,	0x30cc,	0x30cf,	0x30f0,	0x30f3,	0x30fc,	0x30ff,
		0x3300,	0x3303,	0x330c,	0x330f,	0x3330,	0x3333,	0x333c,	0x333f,
		0x33c0,	0x33c3,	0x33cc,	0x33cf,	0x33f0,	0x33f3,	0x33fc,	0x33ff,
		0x3c00,	0x3c03,	0x3c0c,	0x3c0f,	0x3c30,	0x3c33,	0x3c3c,	0x3c3f,
		0x3cc0,	0x3cc3,	0x3ccc,	0x3ccf,	0x3cf0,	0x3cf3,	0x3cfc,	0x3cff,
		0x3f00,	0x3f03,	0x3f0c,	0x3f0f,	0x3f30,	0x3f33,	0x3f3c,	0x3f3f,
		0x3fc0,	0x3fc3,	0x3fcc,	0x3fcf,	0x3ff0,	0x3ff3,	0x3ffc,	0x3fff
	};

	private static final int GR_TO_DHGR[] = new int[] {
		0x0000, 0x0000,
		0x1111, 0x0444,
		0x2222, 0x0888,
		0x3333, 0x0ccc,
		0x0444, 0x1111,
		0x1555, 0x1555,
		0x2666, 0x1999,
		0x3777, 0x1ddd,
		0x0888, 0x2222,
		0x1999, 0x2666,
		0x2aaa, 0x2aaa,
		0x3bbb, 0x2eee,
		0x0ccc, 0x3333,
		0x1ddd, 0x3777,
		0x2eee, 0x3bbb,
		0x3fff, 0x3fff
	};

	private enum DisplayType {
		TEXT40,
		TEXT80,
		LORES40,
		LORES40M,
		LORES80,
		HIRES40,
		HIRES40M,
		HIRES80
	}

	public DisplayIIe(MemoryBusIIe memoryBus, KeyboardIIe keyboard, long unitsPerCycle) throws HardwareException {
	
		super(unitsPerCycle);
		this.keyboard = keyboard;
		
		setMemoryBus(memoryBus);
		tracer = new ScanlineTracer8();
		tracer.setScanStart(25, 70);
		tracer.setScanSize(65, 262);
		initializeWindow();
		if( startFullscreenOnLaunch ) {
			if( "sdl".equals(windowBackend) )
				pendingStartFullscreen = true;
			else
				toggleFullscreen();
		}
		coldReset();
		initializationComplete = true;
	}

	public static void setKeyLoggingEnabled(boolean enabled) {
		keyLoggingEnabled = enabled;
	}

	private void initializeWindow() throws HardwareException {
		if( "sdl".equals(windowBackend) )
			initializeSdlWindow();
		else
			initializeLwjglWindow();
	}

	private void initializeLwjglWindow() throws HardwareException {
		if( !GLFW.glfwInit() )
			throw new HardwareException("Unable to initialize GLFW");
		GLFW.glfwDefaultWindowHints();
		GLFW.glfwWindowHint(GLFW.GLFW_VISIBLE, GLFW.GLFW_TRUE);
		GLFW.glfwWindowHint(GLFW.GLFW_RESIZABLE, GLFW.GLFW_TRUE);
		GLFW.glfwWindowHint(GLFW.GLFW_CONTEXT_VERSION_MAJOR, 2);
		GLFW.glfwWindowHint(GLFW.GLFW_CONTEXT_VERSION_MINOR, 1);
		glfwWindow = GLFW.glfwCreateWindow(WINDOW_WIDTH, WINDOW_HEIGHT, "Ever2E", 0L, 0L);
		if( glfwWindow==0L ) {
			GLFW.glfwTerminate();
			throw new HardwareException("Unable to create GLFW window");
		}
		GLFW.glfwMakeContextCurrent(glfwWindow);
		GL.createCapabilities();
		GLFW.glfwSwapInterval(1);
		GLFW.glfwSetInputMode(glfwWindow, GLFW.GLFW_CURSOR, GLFW.GLFW_CURSOR_HIDDEN);
		GLFW.glfwSetFramebufferSizeCallback(glfwWindow, (window, width, height) -> GL11.glViewport(0, 0, width, height));
		GLFW.glfwSetWindowPosCallback(glfwWindow, (window, x, y) -> {
			if( System.nanoTime()<fullscreenTransitionGuardUntilNs )
				return;
			if( !fullscreen && GLFW.glfwGetWindowAttrib(window, GLFW.GLFW_MAXIMIZED)==GLFW.GLFW_FALSE ) {
				windowedX = x;
				windowedY = y;
			}
		});
		GLFW.glfwSetWindowSizeCallback(glfwWindow, (window, width, height) -> {
			if( System.nanoTime()<fullscreenTransitionGuardUntilNs )
				return;
			if( !fullscreen && GLFW.glfwGetWindowAttrib(window, GLFW.GLFW_MAXIMIZED)==GLFW.GLFW_FALSE &&
					!isLikelyFullscreenSized(width, height) ) {
				windowedWidth = width;
				windowedHeight = height;
			}
		});
		java.nio.IntBuffer fbWidth = BufferUtils.createIntBuffer(1);
		java.nio.IntBuffer fbHeight = BufferUtils.createIntBuffer(1);
		GLFW.glfwGetFramebufferSize(glfwWindow, fbWidth, fbHeight);
		GL11.glViewport(0, 0, fbWidth.get(0), fbHeight.get(0));
		GL11.glEnable(GL11.GL_TEXTURE_2D);
		textureId = GL11.glGenTextures();
		GL11.glBindTexture(GL11.GL_TEXTURE_2D, textureId);
		GL11.glTexParameteri(GL11.GL_TEXTURE_2D, GL11.GL_TEXTURE_WRAP_S, GL12.GL_CLAMP_TO_EDGE);
		GL11.glTexParameteri(GL11.GL_TEXTURE_2D, GL11.GL_TEXTURE_WRAP_T, GL12.GL_CLAMP_TO_EDGE);
		setTextureFiltering(false);
		GL11.glTexImage2D(GL11.GL_TEXTURE_2D, 0, GL11.GL_RGBA8, CONTENT_WIDTH, CONTENT_HEIGHT, 0,
				GL12.GL_BGRA, GL12.GL_UNSIGNED_INT_8_8_8_8_REV, (java.nio.IntBuffer) null);
		uploadPixels = BufferUtils.createIntBuffer(CONTENT_WIDTH * CONTENT_HEIGHT);
		GLFW.glfwSetKeyCallback(glfwWindow, (window, key, scancode, action, mods) -> {
			char keyChar = mapKeyChar(key, scancode, mods);
			boolean fullscreenToggle = action==GLFW.GLFW_PRESS &&
					(((mods&GLFW.GLFW_MOD_SUPER)!=0 && (mods&GLFW.GLFW_MOD_CONTROL)!=0 && Character.toLowerCase(keyChar)=='f') ||
					 ((mods&GLFW.GLFW_MOD_SUPER)!=0 && (key==GLFW.GLFW_KEY_ENTER || key==GLFW.GLFW_KEY_KP_ENTER)));
			if( fullscreenToggle ) {
				toggleFullscreen();
				return;
			}
			int awtKeyCode = toAwtKeyCode(key);
			if( awtKeyCode==KeyEvent.VK_UNDEFINED )
				return;
			int awtModifiers = toAwtModifiers(mods);
			boolean shiftDown = (mods&GLFW.GLFW_MOD_SHIFT)!=0;
			boolean ctrlDown = (mods&GLFW.GLFW_MOD_CONTROL)!=0;
			boolean altDown = (mods&GLFW.GLFW_MOD_ALT)!=0;
			boolean metaDown = (mods&GLFW.GLFW_MOD_SUPER)!=0;
			if( keyLoggingEnabled ) {
				System.err.println("[lwjgl-key] action="+action+
						" key="+key+
						" awt="+awtKeyCode+
						" char="+(keyChar==KeyEvent.CHAR_UNDEFINED ? "undef":Integer.toString((int) keyChar))+
						" shift="+shiftDown+
						" ctrl="+ctrlDown+
						" alt="+altDown+
						" meta="+metaDown+
						" mods=0x"+Integer.toHexString(mods));
			}
			if( action==GLFW.GLFW_PRESS || action==GLFW.GLFW_REPEAT ) {
				keyboard.keyPressedRaw(awtKeyCode, awtModifiers, keyChar, shiftDown, ctrlDown, altDown, metaDown);
			}
			else if( action==GLFW.GLFW_RELEASE ) {
				keyboard.keyReleasedRaw(awtKeyCode, awtModifiers, keyChar, shiftDown, ctrlDown, altDown, metaDown);
			}
		});
	}

	private void toggleFullscreen() {
		if( "sdl".equals(windowBackend) ) {
			toggleSdlFullscreen();
			return;
		}
		if( glfwWindow==0L )
			return;
		fullscreenTransitionGuardUntilNs = System.nanoTime() + FULLSCREEN_TRANSITION_GUARD_NS;
		if( !fullscreen ) {
			if( GLFW.glfwGetWindowAttrib(glfwWindow, GLFW.GLFW_MAXIMIZED)==GLFW.GLFW_FALSE ) {
				java.nio.IntBuffer xBuf = BufferUtils.createIntBuffer(1);
				java.nio.IntBuffer yBuf = BufferUtils.createIntBuffer(1);
				java.nio.IntBuffer wBuf = BufferUtils.createIntBuffer(1);
				java.nio.IntBuffer hBuf = BufferUtils.createIntBuffer(1);
				GLFW.glfwGetWindowPos(glfwWindow, xBuf, yBuf);
				GLFW.glfwGetWindowSize(glfwWindow, wBuf, hBuf);
				windowedX = xBuf.get(0);
				windowedY = yBuf.get(0);
				windowedWidth = wBuf.get(0);
				windowedHeight = hBuf.get(0);
			}
			long monitor = GLFW.glfwGetPrimaryMonitor();
			if( monitor==0L )
				return;
			org.lwjgl.glfw.GLFWVidMode mode = GLFW.glfwGetVideoMode(monitor);
			if( mode==null )
				return;
			GLFW.glfwSetWindowMonitor(glfwWindow, monitor, 0, 0, mode.width(), mode.height(), mode.refreshRate());
			fullscreen = true;
		}
		else {
			GLFW.glfwSetWindowMonitor(glfwWindow, 0L, windowedX, windowedY, windowedWidth, windowedHeight, 0);
			fullscreen = false;
		}
	}

	private boolean isLikelyFullscreenSized(int width, int height) {
		long monitor = GLFW.glfwGetPrimaryMonitor();
		if( monitor==0L )
			return false;
		org.lwjgl.glfw.GLFWVidMode mode = GLFW.glfwGetVideoMode(monitor);
		if( mode==null )
			return false;
		return width >= (int) Math.floor(mode.width() * 0.95) &&
				height >= (int) Math.floor(mode.height() * 0.95);
	}

	private void initializeSdlWindow() throws HardwareException {
		// Match MAME SDL behavior on macOS as closely as practical.
		if( sdlTextAnchorDebug )
			System.err.println("[debug] sdl_init step=hints_begin");
		SDLHints.SDL_SetHint(SDLHints.SDL_HINT_VIDEO_MINIMIZE_ON_FOCUS_LOSS, "0");
		SDLHints.SDL_SetHint(SDLHints.SDL_HINT_VIDEO_MAC_FULLSCREEN_SPACES, "0");
		SDLHints.SDL_SetHint(SDLHints.SDL_HINT_IME_IMPLEMENTED_UI, sdlImeUiSelfImplemented ? "1" : "0");
		if( sdlTextAnchorDebug )
			System.err.println("[debug] sdl_init step=init_video_events");
		if( !SDLInit.SDL_Init(SDLInit.SDL_INIT_VIDEO | SDLInit.SDL_INIT_EVENTS) ) {
			throw new HardwareException("Unable to initialize SDL: " + SDLError.SDL_GetError());
		}
		if( sdlTextAnchorDebug )
			System.err.println("[debug] sdl_init step=create_window");
		sdlWindow = SDLVideo.SDL_CreateWindow("Ever2E", WINDOW_WIDTH, WINDOW_HEIGHT, SDLVideo.SDL_WINDOW_RESIZABLE);
		if( sdlWindow==0L ) {
			SDLInit.SDL_Quit();
			throw new HardwareException("Unable to create SDL window: " + SDLError.SDL_GetError());
		}
		if( sdlTextAnchorDebug )
			System.err.println("[debug] sdl_init step=create_renderer");
		sdlRenderer = SDLRender.nSDL_CreateRenderer(sdlWindow, 0L);
		if( sdlRenderer==0L ) {
			SDLVideo.SDL_DestroyWindow(sdlWindow);
			sdlWindow = 0L;
			SDLInit.SDL_Quit();
			throw new HardwareException("Unable to create SDL renderer: " + SDLError.SDL_GetError());
		}
		if( sdlTextAnchorDebug )
			System.err.println("[debug] sdl_init step=create_texture");
		sdlTexture = SDLRender.nSDL_CreateTexture(sdlRenderer, SDLPixels.SDL_PIXELFORMAT_ARGB8888,
				SDLRender.SDL_TEXTUREACCESS_STREAMING, CONTENT_WIDTH, CONTENT_HEIGHT);
		if( sdlTexture==0L ) {
			SDLRender.SDL_DestroyRenderer(sdlRenderer);
			sdlRenderer = 0L;
			SDLVideo.SDL_DestroyWindow(sdlWindow);
			sdlWindow = 0L;
			SDLInit.SDL_Quit();
			throw new HardwareException("Unable to create SDL texture: " + SDLError.SDL_GetError());
		}
		sdlTextureBytes = BufferUtils.createByteBuffer(CONTENT_WIDTH * CONTENT_HEIGHT * 4);
		sdlTextureInts = sdlTextureBytes.asIntBuffer();
		pendingSdlTextInputModeApply = true;
		pendingSdlInputGrabApply = true;
		if( sdlTextAnchorDebug )
			System.err.println("[debug] sdl_init step=defer_input_grab");
		if( sdlTextAnchorDebug )
			System.err.println("[debug] sdl_init step=complete");
	}

	private void applySdlTextInputMode() {
		if( sdlWindow==0L )
			return;
		if( "normal".equals(sdlTextInputMode) ) {
			SDLKeyboard.SDL_StartTextInput(sdlWindow);
			return;
		}
		if( "offscreen".equals(sdlTextInputMode) ) {
			SDLKeyboard.SDL_StartTextInput(sdlWindow);
			applySdlTextInputAreaForMode("mode_apply");
			return;
		}
		if( "center".equals(sdlTextInputMode) ) {
			SDLKeyboard.SDL_StartTextInput(sdlWindow);
			applySdlTextInputAreaForMode("mode_apply");
			return;
		}
		SDLKeyboard.SDL_StopTextInput(sdlWindow);
	}

	private void applySdlTextInputAreaForMode(String source) {
		if( sdlWindow==0L )
			return;
		if( "offscreen".equals(sdlTextInputMode) ) {
			java.nio.IntBuffer wBuf = BufferUtils.createIntBuffer(1);
			java.nio.IntBuffer hBuf = BufferUtils.createIntBuffer(1);
			SDLVideo.SDL_GetWindowSizeInPixels(sdlWindow, wBuf, hBuf);
			int width = wBuf.get(0);
			int height = hBuf.get(0);
			int belowY = Math.max(0, hBuf.get(0) + SDL_TEXT_ANCHOR_BELOW_OFFSET);
			try( SDL_Rect.Buffer area = SDL_Rect.calloc(1) ) {
				area.x(0);
				area.y(belowY);
				area.w(1);
				area.h(1);
				SDLKeyboard.SDL_SetTextInputArea(sdlWindow, area, 0);
			}
			if( sdlTextAnchorDebug ) {
				System.err.println("[debug] sdl_text_anchor source="+source+
						" mode=offscreen"+
						" windowPx="+width+"x"+height+
						" anchor=0,"+belowY+
						" imeSelfUi="+sdlImeUiSelfImplemented+
						" fullscreen="+fullscreen);
			}
		}
		else if( "center".equals(sdlTextInputMode) ) {
			java.nio.IntBuffer wBuf = BufferUtils.createIntBuffer(1);
			java.nio.IntBuffer hBuf = BufferUtils.createIntBuffer(1);
			SDLVideo.SDL_GetWindowSizeInPixels(sdlWindow, wBuf, hBuf);
			int width = wBuf.get(0);
			int height = hBuf.get(0);
			int cx = Math.max(0, width / 2);
			int cy = Math.max(0, height / 2);
			try( SDL_Rect.Buffer area = SDL_Rect.calloc(1) ) {
				area.x(cx);
				area.y(cy);
				area.w(1);
				area.h(1);
				SDLKeyboard.SDL_SetTextInputArea(sdlWindow, area, 0);
			}
			if( sdlTextAnchorDebug ) {
				System.err.println("[debug] sdl_text_anchor source="+source+
						" mode=center"+
						" windowPx="+width+"x"+height+
						" anchor="+cx+","+cy+
						" imeSelfUi="+sdlImeUiSelfImplemented+
						" fullscreen="+fullscreen);
			}
		}
	}

	private void toggleSdlFullscreen() {
		if( sdlWindow==0L )
			return;
		if( !fullscreen ) {
			java.nio.IntBuffer xBuf = BufferUtils.createIntBuffer(1);
			java.nio.IntBuffer yBuf = BufferUtils.createIntBuffer(1);
			java.nio.IntBuffer wBuf = BufferUtils.createIntBuffer(1);
			java.nio.IntBuffer hBuf = BufferUtils.createIntBuffer(1);
			SDLVideo.SDL_GetWindowPosition(sdlWindow, xBuf, yBuf);
			SDLVideo.SDL_GetWindowSize(sdlWindow, wBuf, hBuf);
			windowedX = xBuf.get(0);
			windowedY = yBuf.get(0);
			windowedWidth = wBuf.get(0);
			windowedHeight = hBuf.get(0);
			recreateSdlWindow(true);
		}
		else {
			recreateSdlWindow(false);
		}
	}

	private void recreateSdlWindow(boolean targetFullscreen) {
		try {
			closeSdlWindow(false);
			initializeSdlWindow();
			if( targetFullscreen ) {
				if( "desktop".equals(sdlFullscreenMode) ) {
					SDLVideo.nSDL_SetWindowFullscreenMode(sdlWindow, 0L);
				}
				else {
					int display = SDLVideo.SDL_GetDisplayForWindow(sdlWindow);
					SDL_DisplayMode mode = display!=0 ? SDLVideo.SDL_GetCurrentDisplayMode(display) : null;
					if( mode!=null )
						SDLVideo.SDL_SetWindowFullscreenMode(sdlWindow, mode);
				}
				SDLVideo.SDL_SetWindowFullscreen(sdlWindow, true);
				fullscreen = true;
			}
			else {
				SDLVideo.SDL_SetWindowPosition(sdlWindow, windowedX, windowedY);
				SDLVideo.SDL_SetWindowSize(sdlWindow, windowedWidth, windowedHeight);
				fullscreen = false;
			}
			SDLVideo.SDL_RaiseWindow(sdlWindow);
		}
		catch( HardwareException e ) {
			throw new RuntimeException("Failed to recreate SDL window during fullscreen toggle", e);
		}
	}

	private void setTextureFiltering(boolean linear) {
		if( textureId==0 )
			return;
		if( textureFilteringInitialized && linearFilteringActive==linear )
			return;
		GL11.glBindTexture(GL11.GL_TEXTURE_2D, textureId);
		int filter = linear ? GL11.GL_LINEAR : GL11.GL_NEAREST;
		GL11.glTexParameteri(GL11.GL_TEXTURE_2D, GL11.GL_TEXTURE_MIN_FILTER, filter);
		GL11.glTexParameteri(GL11.GL_TEXTURE_2D, GL11.GL_TEXTURE_MAG_FILTER, filter);
		linearFilteringActive = linear;
		textureFilteringInitialized = true;
	}

	private int toAwtModifiers(int glfwMods) {
		int mods = 0;
		if( (glfwMods&GLFW.GLFW_MOD_SHIFT)!=0 )
			mods |= Event.SHIFT_MASK;
		if( (glfwMods&GLFW.GLFW_MOD_CONTROL)!=0 )
			mods |= Event.CTRL_MASK;
		if( (glfwMods&GLFW.GLFW_MOD_ALT)!=0 )
			mods |= Event.ALT_MASK;
		if( (glfwMods&GLFW.GLFW_MOD_SUPER)!=0 )
			mods |= Event.META_MASK;
		if( (glfwMods&GLFW.GLFW_MOD_CAPS_LOCK)!=0 )
			mods |= Event.CAPS_LOCK;
		return mods;
	}

	private int toAwtModifiersFromSdl(short sdlMods) {
		int mods = 0;
		if( (sdlMods&SDLKeycode.SDL_KMOD_SHIFT)!=0 )
			mods |= Event.SHIFT_MASK;
		if( (sdlMods&SDLKeycode.SDL_KMOD_CTRL)!=0 )
			mods |= Event.CTRL_MASK;
		if( (sdlMods&SDLKeycode.SDL_KMOD_ALT)!=0 )
			mods |= Event.ALT_MASK;
		if( (sdlMods&SDLKeycode.SDL_KMOD_GUI)!=0 )
			mods |= Event.META_MASK;
		if( (sdlMods&SDLKeycode.SDL_KMOD_CAPS)!=0 )
			mods |= Event.CAPS_LOCK;
		return mods;
	}

	private char mapSdlKeyChar(int sdlKeycode) {
		if( sdlKeycode >= 32 && sdlKeycode <= 126 ) {
			char out = (char) sdlKeycode;
			return Character.isLetter(out) ? Character.toLowerCase(out) : out;
		}
		return KeyEvent.CHAR_UNDEFINED;
	}

	private char mapKeyChar(int key, int scancode, int mods) {
		String keyName = GLFW.glfwGetKeyName(key, scancode);
		if( keyName==null || keyName.isEmpty() )
			return KeyEvent.CHAR_UNDEFINED;
		char out = keyName.charAt(0);
		if( Character.isLetter(out) ) {
			out = Character.toLowerCase(out);
		}
		else if( (mods&GLFW.GLFW_MOD_SHIFT)!=0 ) {
			out = Character.toUpperCase(out);
		}
		return out;
	}

	private int toAwtKeyCode(int key) {
		switch( key ) {
			case GLFW.GLFW_KEY_A: return KeyEvent.VK_A;
			case GLFW.GLFW_KEY_B: return KeyEvent.VK_B;
			case GLFW.GLFW_KEY_C: return KeyEvent.VK_C;
			case GLFW.GLFW_KEY_D: return KeyEvent.VK_D;
			case GLFW.GLFW_KEY_E: return KeyEvent.VK_E;
			case GLFW.GLFW_KEY_F: return KeyEvent.VK_F;
			case GLFW.GLFW_KEY_G: return KeyEvent.VK_G;
			case GLFW.GLFW_KEY_H: return KeyEvent.VK_H;
			case GLFW.GLFW_KEY_I: return KeyEvent.VK_I;
			case GLFW.GLFW_KEY_J: return KeyEvent.VK_J;
			case GLFW.GLFW_KEY_K: return KeyEvent.VK_K;
			case GLFW.GLFW_KEY_L: return KeyEvent.VK_L;
			case GLFW.GLFW_KEY_M: return KeyEvent.VK_M;
			case GLFW.GLFW_KEY_N: return KeyEvent.VK_N;
			case GLFW.GLFW_KEY_O: return KeyEvent.VK_O;
			case GLFW.GLFW_KEY_P: return KeyEvent.VK_P;
			case GLFW.GLFW_KEY_Q: return KeyEvent.VK_Q;
			case GLFW.GLFW_KEY_R: return KeyEvent.VK_R;
			case GLFW.GLFW_KEY_S: return KeyEvent.VK_S;
			case GLFW.GLFW_KEY_T: return KeyEvent.VK_T;
			case GLFW.GLFW_KEY_U: return KeyEvent.VK_U;
			case GLFW.GLFW_KEY_V: return KeyEvent.VK_V;
			case GLFW.GLFW_KEY_W: return KeyEvent.VK_W;
			case GLFW.GLFW_KEY_X: return KeyEvent.VK_X;
			case GLFW.GLFW_KEY_Y: return KeyEvent.VK_Y;
			case GLFW.GLFW_KEY_Z: return KeyEvent.VK_Z;
			case GLFW.GLFW_KEY_0: return KeyEvent.VK_0;
			case GLFW.GLFW_KEY_1: return KeyEvent.VK_1;
			case GLFW.GLFW_KEY_2: return KeyEvent.VK_2;
			case GLFW.GLFW_KEY_3: return KeyEvent.VK_3;
			case GLFW.GLFW_KEY_4: return KeyEvent.VK_4;
			case GLFW.GLFW_KEY_5: return KeyEvent.VK_5;
			case GLFW.GLFW_KEY_6: return KeyEvent.VK_6;
			case GLFW.GLFW_KEY_7: return KeyEvent.VK_7;
			case GLFW.GLFW_KEY_8: return KeyEvent.VK_8;
			case GLFW.GLFW_KEY_9: return KeyEvent.VK_9;
			case GLFW.GLFW_KEY_MINUS: return KeyEvent.VK_MINUS;
			case GLFW.GLFW_KEY_EQUAL: return KeyEvent.VK_EQUALS;
			case GLFW.GLFW_KEY_LEFT_BRACKET: return KeyEvent.VK_OPEN_BRACKET;
			case GLFW.GLFW_KEY_RIGHT_BRACKET: return KeyEvent.VK_CLOSE_BRACKET;
			case GLFW.GLFW_KEY_BACKSLASH: return KeyEvent.VK_BACK_SLASH;
			case GLFW.GLFW_KEY_SEMICOLON: return KeyEvent.VK_SEMICOLON;
			case GLFW.GLFW_KEY_APOSTROPHE: return KeyEvent.VK_QUOTE;
			case GLFW.GLFW_KEY_COMMA: return KeyEvent.VK_COMMA;
			case GLFW.GLFW_KEY_PERIOD: return KeyEvent.VK_PERIOD;
			case GLFW.GLFW_KEY_SLASH: return KeyEvent.VK_SLASH;
			case GLFW.GLFW_KEY_GRAVE_ACCENT: return KeyEvent.VK_BACK_QUOTE;
			case GLFW.GLFW_KEY_ENTER: return KeyEvent.VK_ENTER;
			case GLFW.GLFW_KEY_BACKSPACE: return KeyEvent.VK_BACK_SPACE;
			case GLFW.GLFW_KEY_TAB: return KeyEvent.VK_TAB;
			case GLFW.GLFW_KEY_ESCAPE: return KeyEvent.VK_ESCAPE;
			case GLFW.GLFW_KEY_SPACE: return KeyEvent.VK_SPACE;
			case GLFW.GLFW_KEY_LEFT: return KeyEvent.VK_LEFT;
			case GLFW.GLFW_KEY_RIGHT: return KeyEvent.VK_RIGHT;
			case GLFW.GLFW_KEY_UP: return KeyEvent.VK_UP;
			case GLFW.GLFW_KEY_DOWN: return KeyEvent.VK_DOWN;
			case GLFW.GLFW_KEY_LEFT_SHIFT:
			case GLFW.GLFW_KEY_RIGHT_SHIFT: return KeyEvent.VK_SHIFT;
			case GLFW.GLFW_KEY_LEFT_CONTROL:
			case GLFW.GLFW_KEY_RIGHT_CONTROL: return KeyEvent.VK_CONTROL;
			case GLFW.GLFW_KEY_CAPS_LOCK: return KeyEvent.VK_CAPS_LOCK;
			case GLFW.GLFW_KEY_LEFT_ALT:
			case GLFW.GLFW_KEY_RIGHT_ALT: return KeyEvent.VK_ALT;
			case GLFW.GLFW_KEY_LEFT_SUPER:
			case GLFW.GLFW_KEY_RIGHT_SUPER: return KeyEvent.VK_META;
			case GLFW.GLFW_KEY_INSERT: return KeyEvent.VK_INSERT;
			case GLFW.GLFW_KEY_F1: return KeyEvent.VK_F1;
			case GLFW.GLFW_KEY_F2: return KeyEvent.VK_F2;
			case GLFW.GLFW_KEY_F3: return KeyEvent.VK_F3;
			case GLFW.GLFW_KEY_F4: return KeyEvent.VK_F4;
			case GLFW.GLFW_KEY_F5: return KeyEvent.VK_F5;
			case GLFW.GLFW_KEY_F6: return KeyEvent.VK_F6;
			case GLFW.GLFW_KEY_F7: return KeyEvent.VK_F7;
			case GLFW.GLFW_KEY_F8: return KeyEvent.VK_F8;
			case GLFW.GLFW_KEY_F9: return KeyEvent.VK_F9;
			case GLFW.GLFW_KEY_F10: return KeyEvent.VK_F10;
			case GLFW.GLFW_KEY_F11: return KeyEvent.VK_F11;
			case GLFW.GLFW_KEY_F12: return KeyEvent.VK_F12;
			case GLFW.GLFW_KEY_KP_0: return KeyEvent.VK_NUMPAD0;
			case GLFW.GLFW_KEY_KP_1: return KeyEvent.VK_NUMPAD1;
			case GLFW.GLFW_KEY_KP_2: return KeyEvent.VK_NUMPAD2;
			case GLFW.GLFW_KEY_KP_3: return KeyEvent.VK_NUMPAD3;
			case GLFW.GLFW_KEY_KP_4: return KeyEvent.VK_NUMPAD4;
			case GLFW.GLFW_KEY_KP_5: return KeyEvent.VK_NUMPAD5;
			case GLFW.GLFW_KEY_KP_6: return KeyEvent.VK_NUMPAD6;
			case GLFW.GLFW_KEY_KP_7: return KeyEvent.VK_NUMPAD7;
			case GLFW.GLFW_KEY_KP_8: return KeyEvent.VK_NUMPAD8;
			case GLFW.GLFW_KEY_KP_9: return KeyEvent.VK_NUMPAD9;
			case GLFW.GLFW_KEY_KP_DECIMAL: return KeyEvent.VK_DECIMAL;
			case GLFW.GLFW_KEY_KP_DIVIDE: return KeyEvent.VK_DIVIDE;
			case GLFW.GLFW_KEY_KP_MULTIPLY: return KeyEvent.VK_MULTIPLY;
			case GLFW.GLFW_KEY_KP_SUBTRACT: return KeyEvent.VK_SUBTRACT;
			case GLFW.GLFW_KEY_KP_ADD: return KeyEvent.VK_ADD;
			case GLFW.GLFW_KEY_KP_ENTER: return KeyEvent.VK_ENTER;
			case GLFW.GLFW_KEY_KP_EQUAL: return KeyEvent.VK_EQUALS;
			default: return KeyEvent.VK_UNDEFINED;
		}
	}

	private int toAwtKeyCodeFromSdlScancode(int scancode) {
		switch( scancode ) {
			case SDLScancode.SDL_SCANCODE_A: return KeyEvent.VK_A;
			case SDLScancode.SDL_SCANCODE_B: return KeyEvent.VK_B;
			case SDLScancode.SDL_SCANCODE_C: return KeyEvent.VK_C;
			case SDLScancode.SDL_SCANCODE_D: return KeyEvent.VK_D;
			case SDLScancode.SDL_SCANCODE_E: return KeyEvent.VK_E;
			case SDLScancode.SDL_SCANCODE_F: return KeyEvent.VK_F;
			case SDLScancode.SDL_SCANCODE_G: return KeyEvent.VK_G;
			case SDLScancode.SDL_SCANCODE_H: return KeyEvent.VK_H;
			case SDLScancode.SDL_SCANCODE_I: return KeyEvent.VK_I;
			case SDLScancode.SDL_SCANCODE_J: return KeyEvent.VK_J;
			case SDLScancode.SDL_SCANCODE_K: return KeyEvent.VK_K;
			case SDLScancode.SDL_SCANCODE_L: return KeyEvent.VK_L;
			case SDLScancode.SDL_SCANCODE_M: return KeyEvent.VK_M;
			case SDLScancode.SDL_SCANCODE_N: return KeyEvent.VK_N;
			case SDLScancode.SDL_SCANCODE_O: return KeyEvent.VK_O;
			case SDLScancode.SDL_SCANCODE_P: return KeyEvent.VK_P;
			case SDLScancode.SDL_SCANCODE_Q: return KeyEvent.VK_Q;
			case SDLScancode.SDL_SCANCODE_R: return KeyEvent.VK_R;
			case SDLScancode.SDL_SCANCODE_S: return KeyEvent.VK_S;
			case SDLScancode.SDL_SCANCODE_T: return KeyEvent.VK_T;
			case SDLScancode.SDL_SCANCODE_U: return KeyEvent.VK_U;
			case SDLScancode.SDL_SCANCODE_V: return KeyEvent.VK_V;
			case SDLScancode.SDL_SCANCODE_W: return KeyEvent.VK_W;
			case SDLScancode.SDL_SCANCODE_X: return KeyEvent.VK_X;
			case SDLScancode.SDL_SCANCODE_Y: return KeyEvent.VK_Y;
			case SDLScancode.SDL_SCANCODE_Z: return KeyEvent.VK_Z;
			case SDLScancode.SDL_SCANCODE_0: return KeyEvent.VK_0;
			case SDLScancode.SDL_SCANCODE_1: return KeyEvent.VK_1;
			case SDLScancode.SDL_SCANCODE_2: return KeyEvent.VK_2;
			case SDLScancode.SDL_SCANCODE_3: return KeyEvent.VK_3;
			case SDLScancode.SDL_SCANCODE_4: return KeyEvent.VK_4;
			case SDLScancode.SDL_SCANCODE_5: return KeyEvent.VK_5;
			case SDLScancode.SDL_SCANCODE_6: return KeyEvent.VK_6;
			case SDLScancode.SDL_SCANCODE_7: return KeyEvent.VK_7;
			case SDLScancode.SDL_SCANCODE_8: return KeyEvent.VK_8;
			case SDLScancode.SDL_SCANCODE_9: return KeyEvent.VK_9;
			case SDLScancode.SDL_SCANCODE_MINUS: return KeyEvent.VK_MINUS;
			case SDLScancode.SDL_SCANCODE_EQUALS: return KeyEvent.VK_EQUALS;
			case SDLScancode.SDL_SCANCODE_LEFTBRACKET: return KeyEvent.VK_OPEN_BRACKET;
			case SDLScancode.SDL_SCANCODE_RIGHTBRACKET: return KeyEvent.VK_CLOSE_BRACKET;
			case SDLScancode.SDL_SCANCODE_BACKSLASH: return KeyEvent.VK_BACK_SLASH;
			case SDLScancode.SDL_SCANCODE_SEMICOLON: return KeyEvent.VK_SEMICOLON;
			case SDLScancode.SDL_SCANCODE_APOSTROPHE: return KeyEvent.VK_QUOTE;
			case SDLScancode.SDL_SCANCODE_COMMA: return KeyEvent.VK_COMMA;
			case SDLScancode.SDL_SCANCODE_PERIOD: return KeyEvent.VK_PERIOD;
			case SDLScancode.SDL_SCANCODE_SLASH: return KeyEvent.VK_SLASH;
			case SDLScancode.SDL_SCANCODE_GRAVE: return KeyEvent.VK_BACK_QUOTE;
			case SDLScancode.SDL_SCANCODE_RETURN: return KeyEvent.VK_ENTER;
			case SDLScancode.SDL_SCANCODE_BACKSPACE: return KeyEvent.VK_BACK_SPACE;
			case SDLScancode.SDL_SCANCODE_TAB: return KeyEvent.VK_TAB;
			case SDLScancode.SDL_SCANCODE_ESCAPE: return KeyEvent.VK_ESCAPE;
			case SDLScancode.SDL_SCANCODE_SPACE: return KeyEvent.VK_SPACE;
			case SDLScancode.SDL_SCANCODE_LEFT: return KeyEvent.VK_LEFT;
			case SDLScancode.SDL_SCANCODE_RIGHT: return KeyEvent.VK_RIGHT;
			case SDLScancode.SDL_SCANCODE_UP: return KeyEvent.VK_UP;
			case SDLScancode.SDL_SCANCODE_DOWN: return KeyEvent.VK_DOWN;
			case SDLScancode.SDL_SCANCODE_LSHIFT:
			case SDLScancode.SDL_SCANCODE_RSHIFT: return KeyEvent.VK_SHIFT;
			case SDLScancode.SDL_SCANCODE_LCTRL:
			case SDLScancode.SDL_SCANCODE_RCTRL: return KeyEvent.VK_CONTROL;
			case SDLScancode.SDL_SCANCODE_CAPSLOCK: return KeyEvent.VK_CAPS_LOCK;
			case SDLScancode.SDL_SCANCODE_LALT:
			case SDLScancode.SDL_SCANCODE_RALT: return KeyEvent.VK_ALT;
			case SDLScancode.SDL_SCANCODE_LGUI:
			case SDLScancode.SDL_SCANCODE_RGUI: return KeyEvent.VK_META;
			case SDLScancode.SDL_SCANCODE_INSERT: return KeyEvent.VK_INSERT;
			case SDLScancode.SDL_SCANCODE_F1: return KeyEvent.VK_F1;
			case SDLScancode.SDL_SCANCODE_F2: return KeyEvent.VK_F2;
			case SDLScancode.SDL_SCANCODE_F3: return KeyEvent.VK_F3;
			case SDLScancode.SDL_SCANCODE_F4: return KeyEvent.VK_F4;
			case SDLScancode.SDL_SCANCODE_F5: return KeyEvent.VK_F5;
			case SDLScancode.SDL_SCANCODE_F6: return KeyEvent.VK_F6;
			case SDLScancode.SDL_SCANCODE_F7: return KeyEvent.VK_F7;
			case SDLScancode.SDL_SCANCODE_F8: return KeyEvent.VK_F8;
			case SDLScancode.SDL_SCANCODE_F9: return KeyEvent.VK_F9;
			case SDLScancode.SDL_SCANCODE_F10: return KeyEvent.VK_F10;
			case SDLScancode.SDL_SCANCODE_F11: return KeyEvent.VK_F11;
			case SDLScancode.SDL_SCANCODE_F12: return KeyEvent.VK_F12;
			case SDLScancode.SDL_SCANCODE_KP_0: return KeyEvent.VK_NUMPAD0;
			case SDLScancode.SDL_SCANCODE_KP_1: return KeyEvent.VK_NUMPAD1;
			case SDLScancode.SDL_SCANCODE_KP_2: return KeyEvent.VK_NUMPAD2;
			case SDLScancode.SDL_SCANCODE_KP_3: return KeyEvent.VK_NUMPAD3;
			case SDLScancode.SDL_SCANCODE_KP_4: return KeyEvent.VK_NUMPAD4;
			case SDLScancode.SDL_SCANCODE_KP_5: return KeyEvent.VK_NUMPAD5;
			case SDLScancode.SDL_SCANCODE_KP_6: return KeyEvent.VK_NUMPAD6;
			case SDLScancode.SDL_SCANCODE_KP_7: return KeyEvent.VK_NUMPAD7;
			case SDLScancode.SDL_SCANCODE_KP_8: return KeyEvent.VK_NUMPAD8;
			case SDLScancode.SDL_SCANCODE_KP_9: return KeyEvent.VK_NUMPAD9;
			case SDLScancode.SDL_SCANCODE_KP_PERIOD: return KeyEvent.VK_DECIMAL;
			case SDLScancode.SDL_SCANCODE_KP_DIVIDE: return KeyEvent.VK_DIVIDE;
			case SDLScancode.SDL_SCANCODE_KP_MULTIPLY: return KeyEvent.VK_MULTIPLY;
			case SDLScancode.SDL_SCANCODE_KP_MINUS: return KeyEvent.VK_SUBTRACT;
			case SDLScancode.SDL_SCANCODE_KP_PLUS: return KeyEvent.VK_ADD;
			case SDLScancode.SDL_SCANCODE_KP_ENTER: return KeyEvent.VK_ENTER;
			case SDLScancode.SDL_SCANCODE_KP_EQUALS: return KeyEvent.VK_EQUALS;
			default: return KeyEvent.VK_UNDEFINED;
		}
	}

	public void setShowFps(boolean showFps) {
		this.showFps = showFps;
		this.fpsWindowStartNs = System.nanoTime();
		this.fpsFrameCount = 0;
	}

	private void evaluateSwitchChange() {

		// Visible page is set by PAGE2 flag if 80STORE is off - Sather 8-19
		tracer.setPage(memoryBus.isPage2()&&!memoryBus.is80Store() ? 2:1);

		// Character setting for text modes
		if( memoryBus.isAltCharSet() )
			textMod = 2;
		else
			textMod = (flashToggle&0x10)!=0 ? 1:0;

		// Notes on HIRES40M / LORES40M - Sather 8-22
		// TEXT40 bytes read bit 7 when AN3 is off and hires mode is being used - Sather 8-41
		// This is not currently implemented as replacing the video ROM with something that would use
		//   this feature is not currently implemented
		DisplayType displayTypeTop;
		DisplayType displayTypeBottom;

		if( memoryBus.isText() )
			displayTypeTop = memoryBus.is80Col() ? DisplayType.TEXT80:DisplayType.TEXT40;
		else {
			if( memoryBus.isHiRes() )
				displayTypeTop = ( memoryBus.is80Col() && !memoryBus.isAn3() ) ?
						DisplayType.HIRES80 : ( memoryBus.isAn3() ? DisplayType.HIRES40:DisplayType.HIRES40M );
			else
				displayTypeTop = ( memoryBus.is80Col() && !memoryBus.isAn3() ) ?
						DisplayType.LORES80 : ( memoryBus.isAn3() ? DisplayType.LORES40:DisplayType.LORES40M );
		}

		// Set bottom panel display
		if( memoryBus.isMixed() )
			displayTypeBottom = memoryBus.is80Col() ? DisplayType.TEXT80:DisplayType.TEXT40;
		else
			displayTypeBottom = displayTypeTop;

		// Turn color burst cycle off if in text-only mode
		if( displayTypeTop==DisplayType.TEXT40 || displayTypeTop==DisplayType.TEXT80 )
			palIndex = PAL_INDEX_MONO;
		else
			palIndex = PAL_INDEX_COLOR;

		// Set display mode for the given scanline
		displayType = yPaint<SPLIT_DRAW ? displayTypeTop:displayTypeBottom;

		// Adjust the 40/80 7-bit offset
		if( displayType==DisplayType.HIRES80 || displayType==DisplayType.LORES80 ||
				displayType==DisplayType.TEXT80 ) {
			colorWordSize -= offset40;
			offset40 = 0;
		}
		else {
			colorWordSize += OFFSET40 - offset40;
			offset40 = OFFSET40;
		}

		// Set the addressing mode
		if( displayType==DisplayType.HIRES40 || displayType==DisplayType.HIRES40M ||
				displayType==DisplayType.HIRES80 )
			tracer.setTraceMap(DisplayIIe.HI40_TRACE);
		else
			tracer.setTraceMap(DisplayIIe.LO40_TRACE);

	}

	@Override
	public void cycle() throws HardwareException {

		incSleepCycles(1);

		if( !tracer.isBlank() ) {
			tracer.cycle();
			if( tracer.isHbl() ) {
				xPaint = 0;
				colorWord = 0;
				colorWordSize = offset40;
				shiftBit = 0;
				yPaint += 2;
				if( yPaint==SPLIT_DRAW )
					lastSwitchIteration--;
				else if( yPaint==YSIZE ) {
					yPaint = 0;
					lastSwitchIteration--;
					flipPage();
					cleanEdges();
				}
				if( tracer.isVbl() ) {
					flashToggle++;
					if( textMod<2 )
						textMod = (flashToggle&0x10)!=0 ? 1:0;
				}
				return;
			}
		} else {
			tracer.cycle();
			if( tracer.isBlank() )
				return;
		}

		// *** TODO change this to evaluate only display switch changes
		int switchIteration = memoryBus.getSwitchIteration();
		if( lastSwitchIteration!=switchIteration ) {
			lastSwitchIteration = switchIteration;
			evaluateSwitchChange();
		}

		int gfxWord = 0;
		int readValue = 0;
		int readValueExt = 0;
		int readAddress = tracer.getAddress();

		switch( displayType ) {

		case HIRES40:
			readValue = memory.getByte(readAddress);
			gfxWord = HGR_TO_DHGR[readValue&0x7f];
			if( (readValue&0x80)!=0 ) {
				gfxWord <<= 1;
				gfxWord &= 0x3fff;
				gfxWord |= shiftBit;
			}
			shiftBit = (gfxWord&0x2000)!=0 ? 1:0;
			break;

		case HIRES40M:
			readValue = memory.getByte(readAddress);
			gfxWord = HGR_TO_DHGR[readValue&0x7f];
			break;

		case HIRES80:
			readValue = memory.getByte(0x10000|readAddress);
			gfxWord = readValue;
			readValue = memory.getByte(readAddress);
			gfxWord |= readValue<<7;
			break;

		case LORES40:
			readValue = memory.getByte(readAddress);
			readValue =  (yPaint&0x08)!=0 ? readValue>>4 : readValue&0x0f;
			gfxWord = GR_TO_DHGR[(readValue<<1)+((tracer.getHScan()&0x01)!=0?0:1)];
			break;

		case LORES40M:
			readValue = memory.getByte(readAddress);
			readValue = (yPaint&0x08)!=0 ? readValue>>4 : readValue&0x0f;
			gfxWord = HGR_TO_DHGR[0x7f&GR_TO_DHGR[(readValue<<1)+((tracer.getHScan()&0x01)!=0?0:1)]];
			break;

		case LORES80:
			if( (yPaint&0x08)!=0 ) {
				readValue = memory.getByte(0x10000|readAddress)>>4;
				readValueExt = memory.getByte(readAddress)>>4;
			} else {
				readValue = memory.getByte(0x10000|readAddress)&0x0f;
				readValueExt = memory.getByte(readAddress)&0x0f;
			}
			gfxWord = 0x7f & GR_TO_DHGR[((tracer.getHScan()&0x01)!=0?0:1)+(readValue<<1)];
			gfxWord |= ( 0x7f & GR_TO_DHGR[((tracer.getHScan()&0x01)!=0?0:1)+(readValueExt<<1)] ) << 7;
			break;

		case TEXT40:
			readValue = memory.getByte(readAddress);
			gfxWord = HGR_TO_DHGR[TEXT_DISPLAY[(textMod<<11)+(readValue*8+((yPaint&0x0e)>>1))]];
			break;

		case TEXT80:
			readValue = memory.getByte(0x10000|readAddress);
			gfxWord = TEXT_DISPLAY[(textMod<<11)+(readValue*8+((yPaint&0x0e)>>1))];
			readValue = memory.getByte(readAddress);
			gfxWord |= TEXT_DISPLAY[(textMod<<11)+(readValue*8+((yPaint&0x0e)>>1))]<<7;
			break;

		}

		colorWord |= colorWordSize>=0 ? gfxWord<<colorWordSize : gfxWord>>-colorWordSize;
		colorWordSize += 14;
		if( xPaint==552 )
			colorWordSize += 3;
		
		BufferedImage display = rawDisplay[bufferPage];
		while( colorWordSize>=4 ) {
			int colorCode = palIndex+(colorWord&0x0f);
			int outColor = pal[colorCode];
			int bleedColor = pal[colorCode+16];
			int scanColor = pal[colorCode+32];
			if( (colorCode&1)!=0 ) {
				display.setRGB(xPaint, yPaint, outColor);
				display.setRGB(xPaint++, yPaint+1, scanColor);
			} else {
				display.setRGB(xPaint, yPaint, bleedColor);
				display.setRGB(xPaint++, yPaint+1, bleedColor);
			}
			if( (colorCode&2)!=0 ) {
				display.setRGB(xPaint, yPaint, outColor);
				display.setRGB(xPaint++, yPaint+1, scanColor);
			} else {
				display.setRGB(xPaint, yPaint, bleedColor);
				display.setRGB(xPaint++, yPaint+1, bleedColor);
			}
			if( (colorCode&4)!=0 ) {
				display.setRGB(xPaint, yPaint, outColor);
				display.setRGB(xPaint++, yPaint+1, scanColor);
			} else {
				display.setRGB(xPaint, yPaint, bleedColor);
				display.setRGB(xPaint++, yPaint+1, bleedColor);
			}
			if( (colorCode&8)!=0 ) {
				display.setRGB(xPaint, yPaint, outColor);
				display.setRGB(xPaint++, yPaint+1, scanColor);
			} else {
				display.setRGB(xPaint, yPaint, bleedColor);
				display.setRGB(xPaint++, yPaint+1, bleedColor);
			}
			colorWord >>= 4;
			colorWordSize -= 4;
		}

	}

	private void flipPage() {
		paintPage = bufferPage;
		blitToWindow(rawDisplay[paintPage]);
		bufferPage = bufferPage==1 ? 0:1;
		if( showFps ) {
			fpsFrameCount++;
			long nowNs = System.nanoTime();
			long elapsedNs = nowNs-fpsWindowStartNs;
			if( elapsedNs>=1_000_000_000L ) {
				double fps = fpsFrameCount*1_000_000_000.0/elapsedNs;
				System.err.println(String.format("[fps] %.2f", fps));
				fpsWindowStartNs = nowNs;
				fpsFrameCount = 0;
			}
		}
	}

	private void blitToWindow(BufferedImage image) {
		if( "sdl".equals(windowBackend) ) {
			blitToSdl(image);
			return;
		}
		blitToLwjgl(image);
	}

	private void blitToLwjgl(BufferedImage image) {
		if( glfwWindow==0L )
			return;
		blitToActiveContext(image, true);
		GLFW.glfwSwapBuffers(glfwWindow);
		GLFW.glfwPollEvents();
		if( GLFW.glfwWindowShouldClose(glfwWindow) ) {
			closeWindow();
			System.exit(0);
		}
	}

	private void blitToSdl(BufferedImage image) {
		if( sdlWindow==0L )
			return;
		if( pendingStartFullscreen && initializationComplete ) {
			pendingStartFullscreen = false;
			enterSdlFullscreenStartup();
		}
		if( pendingSdlTextInputModeApply && initializationComplete ) {
			pendingSdlTextInputModeApply = false;
			applySdlTextInputMode();
		}
		if( pendingSdlInputGrabApply && initializationComplete ) {
			pendingSdlInputGrabApply = false;
			SDLVideo.SDL_SetWindowKeyboardGrab(sdlWindow, true);
			SDLVideo.SDL_SetWindowMouseGrab(sdlWindow, true);
			org.lwjgl.sdl.SDLMouse.SDL_SetWindowRelativeMouseMode(sdlWindow, true);
			org.lwjgl.sdl.SDLMouse.SDL_HideCursor();
			if( sdlTextAnchorDebug )
				System.err.println("[debug] sdl_init step=apply_input_grab");
		}
		int[] pixels = image.getRGB(0, 0, CONTENT_WIDTH, CONTENT_HEIGHT, null, 0, CONTENT_WIDTH);
		sdlTextureInts.clear();
		sdlTextureInts.put(pixels);
		sdlTextureInts.flip();
		SDLRender.nSDL_UpdateTexture(sdlTexture, 0L, MemoryUtil.memAddress(sdlTextureBytes), CONTENT_WIDTH * 4);
		java.nio.IntBuffer fbWidth = BufferUtils.createIntBuffer(1);
		java.nio.IntBuffer fbHeight = BufferUtils.createIntBuffer(1);
		SDLVideo.SDL_GetWindowSizeInPixels(sdlWindow, fbWidth, fbHeight);
		int framebufferWidth = fbWidth.get(0);
		int framebufferHeight = fbHeight.get(0);
		double fitScale = Math.min(framebufferWidth / (double) WINDOW_WIDTH, framebufferHeight / (double) WINDOW_HEIGHT);
		int contentWidth = Math.max(1, (int) Math.round(CONTENT_WIDTH * fitScale));
		int contentHeight = Math.max(1, (int) Math.round(CONTENT_HEIGHT * fitScale));
		int borderX = Math.max(0, (int) Math.round(BORDER_X * fitScale));
		int borderY = Math.max(0, (int) Math.round(BORDER_Y * fitScale));
		int frameWidth = Math.max(1, (int) Math.round(WINDOW_WIDTH * fitScale));
		int frameHeight = Math.max(1, (int) Math.round(WINDOW_HEIGHT * fitScale));
		int frameX = Math.max((framebufferWidth - frameWidth) / 2, 0);
		int frameY = Math.max((framebufferHeight - frameHeight) / 2, 0);
		int contentX = frameX + borderX;
		int contentY = frameY + borderY;
		SDLRender.SDL_SetRenderDrawColor(sdlRenderer, (byte) 0, (byte) 0, (byte) 0, (byte) 0xff);
		SDLRender.SDL_RenderClear(sdlRenderer);
		try( SDL_FRect dst = SDL_FRect.calloc() ) {
			dst.x(contentX);
			dst.y(contentY);
			dst.w(contentWidth);
			dst.h(contentHeight);
			SDLRender.nSDL_RenderTexture(sdlRenderer, sdlTexture, 0L, dst.address());
		}
		SDLRender.SDL_RenderPresent(sdlRenderer);
		if( fullscreen )
			org.lwjgl.sdl.SDLMouse.SDL_HideCursor();
		if( sdlImeUiSelfImplemented && ("offscreen".equals(sdlTextInputMode) || "center".equals(sdlTextInputMode)) )
			applySdlTextInputAreaForMode("frame_tick");
		pollSdlEvents();
	}

	private void enterSdlFullscreenStartup() {
		if( sdlWindow==0L )
			return;
		if( fullscreen )
			return;
		if( "desktop".equals(sdlFullscreenMode) ) {
			SDLVideo.nSDL_SetWindowFullscreenMode(sdlWindow, 0L);
		}
		else {
			int display = SDLVideo.SDL_GetDisplayForWindow(sdlWindow);
			SDL_DisplayMode mode = display!=0 ? SDLVideo.SDL_GetCurrentDisplayMode(display) : null;
			if( mode!=null )
				SDLVideo.SDL_SetWindowFullscreenMode(sdlWindow, mode);
		}
		SDLVideo.SDL_SetWindowFullscreen(sdlWindow, true);
		fullscreen = true;
		SDLVideo.SDL_RaiseWindow(sdlWindow);
		if( sdlTextAnchorDebug )
			System.err.println("[debug] sdl_text_anchor source=startup_fullscreen action=entered_fullscreen");
	}

	private void blitToActiveContext(BufferedImage image, boolean lwjglWindow) {
		int[] pixels = image.getRGB(0, 0, CONTENT_WIDTH, CONTENT_HEIGHT, null, 0, CONTENT_WIDTH);
		uploadPixels.clear();
		uploadPixels.put(pixels);
		uploadPixels.flip();
		GL11.glBindTexture(GL11.GL_TEXTURE_2D, textureId);
		GL11.glTexSubImage2D(GL11.GL_TEXTURE_2D, 0, 0, 0, CONTENT_WIDTH, CONTENT_HEIGHT,
				GL12.GL_BGRA, GL12.GL_UNSIGNED_INT_8_8_8_8_REV, uploadPixels);
		java.nio.IntBuffer fbWidth = BufferUtils.createIntBuffer(1);
		java.nio.IntBuffer fbHeight = BufferUtils.createIntBuffer(1);
		if( lwjglWindow ) {
			GLFW.glfwGetFramebufferSize(glfwWindow, fbWidth, fbHeight);
		}
		else {
			SDLVideo.SDL_GetWindowSizeInPixels(sdlWindow, fbWidth, fbHeight);
		}
		int framebufferWidth = fbWidth.get(0);
		int framebufferHeight = fbHeight.get(0);
		double fitScale = Math.min(framebufferWidth / (double) WINDOW_WIDTH, framebufferHeight / (double) WINDOW_HEIGHT);
		int frameWidth = Math.max(1, (int) Math.round(WINDOW_WIDTH * fitScale));
		int frameHeight = Math.max(1, (int) Math.round(WINDOW_HEIGHT * fitScale));
		int frameX = Math.max((framebufferWidth - frameWidth) / 2, 0);
		int frameY = Math.max((framebufferHeight - frameHeight) / 2, 0);
		int contentWidth = Math.max(1, (int) Math.round(CONTENT_WIDTH * fitScale));
		int contentHeight = Math.max(1, (int) Math.round(CONTENT_HEIGHT * fitScale));
		int borderX = Math.max(0, (int) Math.round(BORDER_X * fitScale));
		int borderY = Math.max(0, (int) Math.round(BORDER_Y * fitScale));
		int contentX = frameX + borderX;
		int contentY = frameY + borderY;
		GL11.glViewport(0, 0, framebufferWidth, framebufferHeight);
		GL11.glClear(GL11.GL_COLOR_BUFFER_BIT);
		boolean scaled = contentWidth!=CONTENT_WIDTH || contentHeight!=CONTENT_HEIGHT;
		setTextureFiltering(scaled);
		GL11.glViewport(contentX, contentY, contentWidth, contentHeight);
		GL11.glMatrixMode(GL11.GL_PROJECTION);
		GL11.glLoadIdentity();
		GL11.glOrtho(-1, 1, -1, 1, -1, 1);
		GL11.glMatrixMode(GL11.GL_MODELVIEW);
		GL11.glLoadIdentity();
		GL11.glBegin(GL11.GL_QUADS);
		GL11.glTexCoord2f(0f, 1f); GL11.glVertex2f(-1f, -1f);
		GL11.glTexCoord2f(1f, 1f); GL11.glVertex2f(1f, -1f);
		GL11.glTexCoord2f(1f, 0f); GL11.glVertex2f(1f, 1f);
		GL11.glTexCoord2f(0f, 0f); GL11.glVertex2f(-1f, 1f);
		GL11.glEnd();
	}

	private void closeWindow() {
		if( textureId!=0 ) {
			GL11.glDeleteTextures(textureId);
			textureId = 0;
		}
		if( "sdl".equals(windowBackend) )
			closeSdlWindow(true);
		else
			closeLwjglWindow();
	}

	private void closeLwjglWindow() {
		if( glfwWindow==0L )
			return;
		GLFW.glfwDestroyWindow(glfwWindow);
		glfwWindow = 0L;
		GLFW.glfwTerminate();
	}

	private void closeSdlWindow(boolean quitSdl) {
		if( sdlGlContext!=0L ) {
			SDLVideo.SDL_GL_DestroyContext(sdlGlContext);
			sdlGlContext = 0L;
		}
		if( sdlTexture!=0L ) {
			SDLRender.nSDL_DestroyTexture(sdlTexture);
			sdlTexture = 0L;
		}
		if( sdlRenderer!=0L ) {
			SDLRender.SDL_DestroyRenderer(sdlRenderer);
			sdlRenderer = 0L;
		}
		if( sdlWindow!=0L ) {
			SDLVideo.SDL_DestroyWindow(sdlWindow);
			sdlWindow = 0L;
		}
		if( quitSdl )
			SDLInit.SDL_Quit();
	}

	private void pollSdlEvents() {
		try( SDL_Event event = SDL_Event.malloc() ) {
			while( SDLEvents.SDL_PollEvent(event) ) {
				int type = event.type();
				if( type==SDLEvents.SDL_EVENT_QUIT || type==SDLEvents.SDL_EVENT_WINDOW_CLOSE_REQUESTED ) {
					closeWindow();
					System.exit(0);
					return;
				}
				if( type==SDLEvents.SDL_EVENT_WINDOW_FOCUS_LOST ) {
					SDLKeyboard.SDL_StopTextInput(sdlWindow);
					if( sdlTextAnchorDebug )
						System.err.println("[debug] sdl_text_anchor source=focus_lost action=stop_text_input");
					continue;
				}
				if( type==SDLEvents.SDL_EVENT_WINDOW_FOCUS_GAINED ) {
					applySdlTextInputMode();
					if( fullscreen )
						org.lwjgl.sdl.SDLMouse.SDL_HideCursor();
					if( sdlTextAnchorDebug )
						System.err.println("[debug] sdl_text_anchor source=focus_gained action=apply_mode");
					continue;
				}
				if( type==SDLEvents.SDL_EVENT_KEY_DOWN || type==SDLEvents.SDL_EVENT_KEY_UP ) {
					processSdlKeyboardEvent(event.key(), type==SDLEvents.SDL_EVENT_KEY_DOWN);
				}
			}
		}
	}

	private void processSdlKeyboardEvent(org.lwjgl.sdl.SDL_KeyboardEvent keyEvent, boolean pressed) {
		int scancode = keyEvent.scancode();
		int key = keyEvent.key();
		short mods = keyEvent.mod();
		boolean repeat = keyEvent.repeat();
		char keyChar = mapSdlKeyChar(key);
		boolean shiftDown = (mods&SDLKeycode.SDL_KMOD_SHIFT)!=0;
		boolean ctrlDown = (mods&SDLKeycode.SDL_KMOD_CTRL)!=0;
		boolean altDown = (mods&SDLKeycode.SDL_KMOD_ALT)!=0;
		boolean metaDown = (mods&SDLKeycode.SDL_KMOD_GUI)!=0;
		boolean fullscreenToggle = pressed && !repeat &&
				(((mods&SDLKeycode.SDL_KMOD_GUI)!=0 && (mods&SDLKeycode.SDL_KMOD_CTRL)!=0 && Character.toLowerCase(keyChar)=='f') ||
				 ((mods&SDLKeycode.SDL_KMOD_GUI)!=0 && (scancode==SDLScancode.SDL_SCANCODE_RETURN || scancode==SDLScancode.SDL_SCANCODE_KP_ENTER)));
		if( fullscreenToggle ) {
			toggleFullscreen();
			return;
		}
		int awtKeyCode = toAwtKeyCodeFromSdlScancode(scancode);
		if( awtKeyCode==KeyEvent.VK_UNDEFINED )
			return;
		int awtModifiers = toAwtModifiersFromSdl(mods);
		if( keyLoggingEnabled ) {
			System.err.println("[sdl-key] action="+(pressed ? 1 : 0)+
					" scancode="+scancode+
					" key="+key+
					" awt="+awtKeyCode+
					" char="+(keyChar==KeyEvent.CHAR_UNDEFINED ? "undef":Integer.toString((int) keyChar))+
					" shift="+shiftDown+
					" ctrl="+ctrlDown+
					" alt="+altDown+
					" meta="+metaDown+
					" mods=0x"+Integer.toHexString(mods & 0xffff));
		}
		if( pressed ) {
			keyboard.keyPressedRaw(awtKeyCode, awtModifiers, keyChar, shiftDown, ctrlDown, altDown, metaDown);
		}
		else {
			keyboard.keyReleasedRaw(awtKeyCode, awtModifiers, keyChar, shiftDown, ctrlDown, altDown, metaDown);
		}
	}

	private void cleanEdges() {
		BufferedImage display = rawDisplay[bufferPage];
		for( int yb = 0; yb < 24*16; yb++ ) {
			for( int xb = 0; xb < 7; xb++ )
				display.setRGB(xb, yb, 0);
			for( int xb = 80*7; xb < 81*7; xb++ )
				display.setRGB(xb, yb, 0);
		}
	}

	public static int getAddressLo40( int page, int scanline, int offset )
	{
		int address = page<<3;
		address |= scanline&0x0007;
		scanline >>= 3;
		address <<= 7;
		address += scanline*40 + offset;
		return address;
	}

	public static int getAddressHi40( int page, int scanline, int offset )
	{
		int address = page<<3;
		address |= scanline&0x0007;
		scanline >>= 3;
		address <<= 3;
		address |= scanline&0x0007;
		scanline >>= 3;
		address <<= 7;
		address += scanline*40 + offset;
		return address;
	}

	@Override
	public void coldReset() throws HardwareException {
		lastSwitchIteration = -1;
		evaluateSwitchChange();
		tracer.coldReset();
		rawDisplay = new BufferedImage[2];
		bufferPage = 0;
		paintPage = 1;
		fpsWindowStartNs = System.nanoTime();
		fpsFrameCount = 0;
		yPaint = YSIZE-2;
		rawDisplay[0] = new BufferedImage(XSIZE+2, YSIZE, BufferedImage.TYPE_INT_RGB);
		rawDisplay[1] = new BufferedImage(XSIZE+2, YSIZE, BufferedImage.TYPE_INT_RGB);
		generatePalette();
		// Randomly position the first scan to simulate an always-on screen
		int randScans = new Random().nextInt(17030);
		memory = new Memory8(0x10000);
		memory.coldReset();
		for( int i = 0; i<randScans; i++ ) {
			incSleepCycles(-1);
			cycle();
		}
		memory = memoryBus.getMemory();
	}

	private void generatePalette() {

		// Add main color palette
		pal = new int[48*3];
		Color [] basePal = new Color[4];

		for( int palIndex = 0; palIndex<4; palIndex++ )
			basePal[palIndex] = new Color(Color.HSBtoRGB((((3-palIndex)<<6)+hueShift)/256f, 1f, PAL_BRIGHTNESS/256f));

		for( int palIndex = 1; palIndex<16; palIndex++ ) {

			Color mix = new Color(0);
			int baseIndex = 0;
			int bits = 0;
			for( int bitMask = palIndex; bitMask>0; bitMask >>= 1, baseIndex++ ){
				if( (bitMask&0x01)!=0 ) {
					bits++;
					int red = Math.min((int)(basePal[baseIndex].getRed())+mix.getRed(), 255);
					int green = Math.min((int)(basePal[baseIndex].getGreen())+mix.getGreen(), 255);
					int blue = Math.min((int)(basePal[baseIndex].getBlue())+mix.getBlue(), 255);
					mix = new Color(red, green, blue);
				}
			}

			if( bits==1 ) {
				int red = Math.min(mix.getRed()*2, 255);
				int green = Math.min(mix.getGreen()*2, 255);
				int blue = Math.min(mix.getBlue()*2, 255);
				mix = new Color(red, green, blue);
			}

			pal[palIndex] = mix.getRGB();

		}

		// Add monochrome
		pal[PAL_INDEX_MONO] = Color.BLACK.getRGB();
		pal[PAL_INDEX_MONO_GREEN] = Color.BLACK.getRGB();
		for( int index = 1; index<16; index++ ) {
			pal[PAL_INDEX_MONO+index] = Color.WHITE.getRGB();
			pal[PAL_INDEX_MONO_GREEN+index] = Color.GREEN.getRGB();
		}

		// Add color bleed palettes
		for( int palSet = 0; palSet<3; palSet++ ) {
			for( int index = 0; index<16; index++ ) {
				// Pixel bleed
				if( palSet*48==PAL_INDEX_COLOR )
					pal[palSet*48+index+16] = new Color(pal[palSet*48+index]).darker().darker().darker().darker().darker().getRGB();
				else
					pal[palSet*48+index+16] = Color.BLACK.getRGB();
				// Blank scanline bleed
				pal[palSet*48+index+32] = new Color(pal[palSet*48+index]).darker().darker().darker().darker().getRGB();
			}
		}

	}

	public int getLastRead() {
		return memory.getByte(tracer.getAddress());
	}

	public boolean isVbl() {
		return tracer.isVbl();
	}

	public void setMemoryBus( MemoryBusIIe memoryBus ) {
		if( memoryBus==null ) {
			memory = new Memory8(0x10000);
			this.memoryBus = new MemoryBusIIe(memory, new byte[0x4000]);
		} else {
			memory = memoryBus.getMemory();
			this.memoryBus = memoryBus;
		}
	}

}
